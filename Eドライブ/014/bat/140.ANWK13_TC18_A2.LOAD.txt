/*定量特売納入日データ(ア有)2*/
/*特売履歴保存日数ファイル：10*/
TRUNCATE TABLE INAWK.ANWK13_TC18_A2;
INSERT IGNORE INTO INAWK.ANWK13_TC18_A2 SELECT WK13.SHOHINCD, WK13.FILLER_01, WK13.SHOHIN_KBN, WK13.BINKBN, WK13.NOU_SDATE, WK13.NOU_EDATE, CASE WHEN WK13.DATA_KBN = 2 AND SHN.MOYSKBN IS NOT NULL THEN WK13.HAN_SDATE ELSE WK13.HAN_SDATE END, CASE WHEN WK13.DATA_KBN = 2 AND SHN.MOYSKBN IS NOT NULL THEN WK13.HAN_EDATE ELSE WK13.HAN_EDATE END, WK13.NOU_DATE, WK13.NOU_DATEYB, WK13.HACHU_DATE, WK13.HACHU_DATEYB, CASE WHEN WK13.DATA_KBN IN (1, 2) AND SHN.MOYSKBN IS NOT NULL THEN SHN.GENKAAM_MAE ELSE WK13.GEN_TOKJIZEN END, CASE WHEN WK13.DATA_KBN IN (1, 2) AND SHN.MOYSKBN IS NOT NULL THEN SHN.GENKAAM_ATO ELSE WK13.TUIKA_GENKA END, CASE WHEN WK13.DATA_KBN IN (1, 2) AND SHN.MOYSKBN IS NOT NULL THEN SHN.GENKAAM_PACK ELSE WK13.PACK_GENKA END, CASE WHEN WK13.DATA_KBN IN (1, 2) AND SHN.MOYSKBN IS NOT NULL THEN SHN.GENKAAM_1KG ELSE WK13.GEN_1KG END, CASE WHEN WK13.DATA_KBN = 2 AND SHN.MOYSKBN IS NOT NULL THEN SHN.A_BAIKAAM ELSE WK13.A_BAI_100G END, CASE WHEN WK13.DATA_KBN = 2 AND SHN.MOYSKBN IS NOT NULL THEN SHN.B_BAIKAAM ELSE WK13.B_BAI_100G END, CASE WHEN WK13.DATA_KBN = 2 AND SHN.MOYSKBN IS NOT NULL THEN SHN.C_BAIKAAM ELSE WK13.C_BAI_100G END, CASE WHEN WK13.DATA_KBN IN (1, 2, 3) AND SHN.MOYSKBN IS NOT NULL THEN SHN.A_BAIKAAM_PACK ELSE WK13.A_BAI_PACK END, CASE WHEN WK13.DATA_KBN IN (1, 2, 3) AND SHN.MOYSKBN IS NOT NULL THEN SHN.B_BAIKAAM_PACK ELSE WK13.B_BAI_PACK END, CASE WHEN WK13.DATA_KBN IN (1, 2, 3) AND SHN.MOYSKBN IS NOT NULL THEN SHN.C_BAIKAAM_PACK ELSE WK13.C_BAI_PACK END, CASE WHEN WK13.DATA_KBN IN (2, 3) AND SHN.MOYSKBN IS NOT NULL THEN SHN.A_GENKAAM_1KG ELSE WK13.A_BAI_1KG END, CASE WHEN WK13.DATA_KBN IN (2, 3) AND SHN.MOYSKBN IS NOT NULL THEN SHN.B_GENKAAM_1KG ELSE WK13.B_BAI_1KG END, CASE WHEN WK13.DATA_KBN IN (2, 3) AND SHN.MOYSKBN IS NOT NULL THEN SHN.C_GENKAAM_1KG ELSE WK13.C_BAI_1KG END, CASE WHEN WK13.DATA_KBN IN (1, 2, 3) AND SHN.MOYSKBN IS NOT NULL THEN SHN.A_BAIKAAM_100G ELSE WK13.A_BAI_100GS END, CASE WHEN WK13.DATA_KBN IN (1, 2, 3) AND SHN.MOYSKBN IS NOT NULL THEN SHN.B_BAIKAAM_100G ELSE WK13.B_BAI_100GS END, CASE WHEN WK13.DATA_KBN IN (1, 2, 3) AND SHN.MOYSKBN IS NOT NULL THEN SHN.C_BAIKAAM_100G ELSE WK13.C_BAI_100GS END, WK13.AVGPTANKA, CASE WHEN WK13.DATA_KBN IN (1, 2) AND SHN.MOYSKBN IS NOT NULL THEN SHN.IRISU ELSE WK13.IRISU END, CASE WHEN WK13.DATA_KBN IN (1, 2) AND SHN.MOYSKBN IS NOT NULL THEN SHN.BD1_TENSU ELSE WK13.TENSUU_BL1 END, CASE WHEN WK13.DATA_KBN IN (1, 2) AND SHN.MOYSKBN IS NOT NULL THEN SHN.BD2_TENSU ELSE WK13.TENSUU_BL2 END, CASE WHEN WK13.DATA_KBN = 2 AND SHN.MOYSKBN IS NOT NULL THEN CASE WHEN SHN.ADDSHUKBN = 1 THEN SHN.A_WRITUKBN ELSE SHN.KO_A_BAIKAAN END ELSE WK13.A_BAI_1URI END, CASE WHEN WK13.DATA_KBN = 2 AND SHN.MOYSKBN IS NOT NULL THEN SHN.BD1_A_BAIKAAN ELSE WK13.A_BAI_BL1 END, CASE WHEN WK13.DATA_KBN = 2 AND SHN.MOYSKBN IS NOT NULL THEN SHN.BD2_A_BAIKAAN ELSE WK13.A_BAI_BL2 END, CASE WHEN WK13.DATA_KBN = 2 AND SHN.MOYSKBN IS NOT NULL THEN CASE WHEN SHN.ADDSHUKBN = 1 THEN SHN.B_WRITUKBN ELSE SHN.KO_B_BAIKAAN END ELSE WK13.B_BAI_1URI END, CASE WHEN WK13.DATA_KBN = 2 AND SHN.MOYSKBN IS NOT NULL THEN SHN.BD1_B_BAIKAAN ELSE WK13.B_BAI_BL1 END, CASE WHEN WK13.DATA_KBN = 2 AND SHN.MOYSKBN IS NOT NULL THEN SHN.BD2_B_BAIKAAN ELSE WK13.B_BAI_BL2 END, CASE WHEN WK13.DATA_KBN = 2 AND SHN.MOYSKBN IS NOT NULL THEN CASE WHEN SHN.ADDSHUKBN = 1 THEN SHN.C_WRITUKBN ELSE SHN.KO_C_BAIKAAN END ELSE WK13.C_BAI_1URI END, CASE WHEN WK13.DATA_KBN = 2 AND SHN.MOYSKBN IS NOT NULL THEN SHN.BD1_C_BAIKAAN ELSE WK13.C_BAI_BL1 END, CASE WHEN WK13.DATA_KBN = 2 AND SHN.MOYSKBN IS NOT NULL THEN SHN.BD2_C_BAIKAAN ELSE WK13.C_BAI_BL2 END, WK13.SIRECD, WK13.NENMATSU, WK13.TEIKBN, WK13.TRTEISEK, WK13.TTKBN, WK13.KZKBN, CASE WHEN WK13.DATA_KBN = 2 AND SHN.MOYSKBN IS NOT NULL THEN SHN.TKANPLUKBN ELSE WK13.FUTEIKBN END, CASE WHEN WK13.DATA_KBN IN (1, 2) AND SHN.MOYSKBN IS NOT NULL THEN SHN.BDENKBN ELSE WK13.BETUDEN_KBN END, CASE WHEN WK13.DATA_KBN IN (1, 2) AND SHN.MOYSKBN IS NOT NULL THEN CAST(SHN.WAPPNKBN AS CHAR (1)) ELSE WK13.WAPPEN END, WK13.IKKATK, WK13.JIZNUT, WK13.SIDENF, WK13.TEICUTK, WK13.HOUZAI, WK13.DSEIK, WK13.PCKBN, CASE WHEN WK13.DATA_KBN IN (1, 2) AND SHN.MOYSKBN IS NOT NULL THEN SHN.HIGAWRFLG ELSE WK13.HIGAWARI_KBN END, CASE WHEN WK13.DATA_KBN IN (1, 2) AND SHN.MOYSKBN IS NOT NULL THEN SHN.HTGENBAIKAFLG ELSE WK13.HGENBAIKA_FLG END, WK13.REI_DMY_FLG, WK13.UPDKBN, WK13.SEISUR, WK13.HENSUR, WK13.SEITK, WK13.NONSJ, WK13.ATARA, WK13.RDHMHYO, WK13.RDHMMON, WK13.RDHMTUE, WK13.RDHMWED, WK13.RDHMTHU, WK13.RDHMFRI, WK13.RDHMSAT, WK13.RDHMSUN, WK13.NONSU, WK13.BUMNCD, WK13.DAIBUNCD, WK13.CHUBUNCD, WK13.SHOBUNCD, WK13.SSBUNCD, WK13.MSSIRE, WK13.MSIR, WK13.MSIKK, WK13.MSWAP, WK13.MSBIN, WK13.EVENT_KBN, WK13.EVENT_SDATE, WK13.EVENT_SEQ, WK13.BUMN, WK13.KANRI_NO, WK13.EVENT_EDANO, WK13.WEEK_NO, WK13.SMISECD, WK13.KZCUT, WK13.KOUCUT, WK13.TEICUT, WK13.TOKCUT, WK13.KYUCUT, WK13.HACCUT, WK13.NONCUT, WK13.HSSCUT, WK13.ZEROCUT, WK13.FILLER_02, WK13.SYORIK, CASE WHEN WK13.DATA_KBN IN (1, 2) AND SHN.MOYSKBN IS NOT NULL THEN SHN.COMMENT_TB ELSE WK13.TOK_COMMENT END, CASE WHEN WK13.DATA_KBN IN (1, 2) AND SHN.MOYSKBN IS NOT NULL THEN SHN.KIKKN ELSE WK13.KIKAKU END, CASE WHEN WK13.DATA_KBN IN (1, 2) AND SHN.MOYSKBN IS NOT NULL THEN SHN.SANCHIKN ELSE WK13.SANCHI END, WK13.JIZEN_DATE, WK13.JH_LIST_DATE, WK13.JH_TORI_DATE, WK13.WEEK_HDATE, CASE WHEN WK13.DATA_KBN IN (1, 2) AND SHN.MOYSKBN IS NOT NULL THEN CAST(SHN.RANKNO_ADD AS SIGNED) ELSE WK13.TAISYO_TEN_RANK END, WK13.TEN_HSUU, WK13.BAI_KBN, WK13.FILLER_03, WK13.SAKUSEI, WK13.DATA_KBN FROM INAWK.ANWK13_TC18_A WK13 LEFT OUTER JOIN (SELECT SHN.*, NUM.SEQ AS TENCD, SUBSTR(SHN.TENRANK_ARR, NUM.SEQ, 1) AS RANKNO FROM INATK2.TOKTG_SHN SHN INNER JOIN INAPARM.MSTNUMS NUM ON 1 = 1 AND NUM.SEQ BETWEEN 1 AND 400) SHN ON WK13.EVENT_KBN = SHN.MOYSKBN AND WK13.EVENT_SDATE = SHN.MOYSSTDT AND WK13.EVENT_SEQ = SHN.MOYSRBAN AND WK13.BUMN = SHN.BMNCD AND WK13.KANRI_NO = SHN.KANRINO AND WK13.EVENT_EDANO = SHN.KANRIENO AND WK13.SMISECD = SHN.TENCD WHERE WK13.DATA_KBN IN (1, 2);
ANALYZE TABLE INAWK.ANWK13_TC18_A2;
commit;
