REM [194][JH_SHIME_DATE]
@ECHO OFF

REM ログフォルダ作成
IF NOT EXIST %~DP0..\logs MKDIR %~DP0..\logs

REM コマンドフォルダ作成
IF NOT EXIST %~DP0..\cmd MKDIR %~DP0..\cmd

REM ログファイルの情報
SET OUTFILE=%~DP0../logs/setup.log
SET OUTTIME=%~DP0../logs/time.log

REM ベースフォルダ
SET BASEDIR=%~DP0..

REM 更新対象の情報
SET INFOSCRIPT=%~DP0..\cmd\%~N0.DB2

SET MSG=%DATE% %TIME% INAIN.BFB00_SHIME → INAIF.JH_SHIME_DATE ロード処理（事前発注数量入力締め日付）
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%

"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% --show-warnings -vv -e "TRUNCATE TABLE INAIF.JH_SHIME_DATE;INSERT IGNORE INTO INAIF.JH_SHIME_DATE SELECT COPY, CAST(SEQ AS SIGNED) AS SEQ, CAST(BMNCD AS SIGNED) AS BMNCD, TOK, TEI, CAST(JIZNUT AS SIGNED) AS JUKBN, CAST(NENMAT AS SIGNED) AS NENMATKBN, FILLER01, CAST(SYORIB AS SIGNED) AS SYORIDT, CAST(YOUBI AS SIGNED) AS SYORI_YOUBI, CAST(TYUKAIS AS SIGNED) AS TYUSTDT, CAST(TYUSYUR AS SIGNED) AS TYUEDDT, CAST(TOKKAIS AS SIGNED) AS TOKSTDT, CAST(TOKSYUR AS SIGNED) AS TOKEDDT, CAST(TDATE01 AS SIGNED) AS TDATE01, CAST(TYOUBI01 AS SIGNED) AS TYOUBI01, CAST(TDATE02 AS SIGNED) AS TDATE02, CAST(TYOUBI02 AS SIGNED) AS TYOUBI02, CAST(TDATE03 AS SIGNED) AS TDATE03, CAST(TYOUBI03 AS SIGNED) AS TYOUBI03, CAST(TDATE04 AS SIGNED) AS TDATE04, CAST(TYOUBI04 AS SIGNED) AS TYOUBI04, CAST(TDATE05 AS SIGNED) AS TDATE05, CAST(TYOUBI05 AS SIGNED) AS TYOUBI05, CAST(TDATE06 AS SIGNED) AS TDATE06, CAST(TYOUBI06 AS SIGNED) AS TYOUBI06, CAST(TDATE07 AS SIGNED) AS TDATE07, CAST(TYOUBI07 AS SIGNED) AS TYOUBI07, CAST(TDATE08 AS SIGNED) AS TDATE08, CAST(TYOUBI08 AS SIGNED) AS TYOUBI08, CAST(TDATE09 AS SIGNED) AS TDATE09, CAST(TYOUBI09 AS SIGNED) AS TYOUBI09, CAST(TDATE10 AS SIGNED) AS TDATE10, CAST(TYOUBI10 AS SIGNED) AS TYOUBI10, CAST(HACKAIS AS SIGNED) AS HACKAIS, CAST(HACSYUR AS SIGNED) AS HACSYUR, CAST(HDATE01 AS SIGNED) AS HDATE01, CAST(HYOUBI01 AS SIGNED) AS HYOUBI01, CAST(HDATE02 AS SIGNED) AS HDATE02, CAST(HYOUBI02 AS SIGNED) AS HYOUBI02, CAST(HDATE03 AS SIGNED) AS HDATE03, CAST(HYOUBI03 AS SIGNED) AS HYOUBI03, CAST(HDATE04 AS SIGNED) AS HDATE04, CAST(HYOUBI04 AS SIGNED) AS HYOUBI04, CAST(HDATE05 AS SIGNED) AS HDATE05, CAST(HYOUBI05 AS SIGNED) AS HYOUBI05, CAST(HDATE06 AS SIGNED) AS HDATE06, CAST(HYOUBI06 AS SIGNED) AS HYOUBI06, CAST(HDATE07 AS SIGNED) AS HDATE07, CAST(HYOUBI07 AS SIGNED) AS HYOUBI07, CAST(HDATE08 AS SIGNED) AS HDATE08, CAST(HYOUBI08 AS SIGNED) AS HYOUBI08, CAST(HDATE09 AS SIGNED) AS HDATE09, CAST(HYOUBI09 AS SIGNED) AS HYOUBI09, CAST(HDATE10 AS SIGNED) AS HDATE10, CAST(HYOUBI10 AS SIGNED) AS HYOUBI10, CAST(HDATE11 AS SIGNED) AS HDATE11, CAST(HYOUBI11 AS SIGNED) AS HYOUBI11, CAST(HDATE12 AS SIGNED) AS HDATE12, CAST(HYOUBI12 AS SIGNED) AS HYOUBI12, CAST(HDATE13 AS SIGNED) AS HDATE13, CAST(HYOUBI13 AS SIGNED) AS HYOUBI13, CAST(HDATE14 AS SIGNED) AS HDATE14, CAST(HYOUBI14 AS SIGNED) AS HYOUBI14, CAST(HDATE15 AS SIGNED) AS HDATE15, CAST(HYOUBI15 AS SIGNED) AS HYOUBI15, CAST(HDATE16 AS SIGNED) AS HDATE16, CAST(HYOUBI16 AS SIGNED) AS HYOUBI16, CAST(LISTNO AS SIGNED) AS LSTNO, CAST(KOTYUKAB AS SIGNED) AS KOTYUSTDT, CAST(KOTYUSYUB AS SIGNED) AS KOTYUEDDT, CAST(SOUSIME AS SIGNED) AS SNDSIMEDT, CAST(KESKAB AS SIGNED) AS SHWSTDT, CAST(KESSYUB AS SIGNED) AS SHWEDDT, TITLE, CAST(JZNKSYHKB AS SIGNED) AS JZNKSYHKBN, CAST(SAKSEIB AS SIGNED) AS ADDDT, FILLER02 FROM INAIN.BFB00_SHIME;COMMIT;" >>%OUTFILE% 2>&1
IF NOT %ERRORLEVEL%==0 GOTO ERROR


REM MERGE中止(20180824)
REM "%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% --show-warnings -vv -e "INSERT INTO INAIF.JH_SHIME_DATE(COPY, SEQ, BMNCD, TOK, TEI, JUKBN, NENMATKBN, FILLER01, SYORIDT, SYORI_YOUBI, TYUSTDT, TYUEDDT, TOKSTDT, TOKEDDT, TDATE01, TYOUBI01, TDATE02, TYOUBI02, TDATE03, TYOUBI03, TDATE04, TYOUBI04, TDATE05, TYOUBI05, TDATE06, TYOUBI06, TDATE07, TYOUBI07, TDATE08, TYOUBI08, TDATE09, TYOUBI09, TDATE10, TYOUBI10, HACKAIS, HACSYUR, HDATE01, HYOUBI01, HDATE02, HYOUBI02, HDATE03, HYOUBI03, HDATE04, HYOUBI04, HDATE05, HYOUBI05, HDATE06, HYOUBI06, HDATE07, HYOUBI07, HDATE08, HYOUBI08, HDATE09, HYOUBI09, HDATE10, HYOUBI10, HDATE11, HYOUBI11, HDATE12, HYOUBI12, HDATE13, HYOUBI13, HDATE14, HYOUBI14, HDATE15, HYOUBI15, HDATE16, HYOUBI16, LSTNO, KOTYUSTDT, KOTYUEDDT, SNDSIMEDT, SHWSTDT, SHWEDDT, TITLE, JZNKSYHKBN, ADDDT, FILLER02) SELECT * FROM (SELECT COPY, CAST(SEQ AS SIGNED) AS SEQ, CAST(BMNCD AS SIGNED) AS BMNCD, TOK, TEI, CAST(JIZNUT AS SIGNED) AS JUKBN, CAST(NENMAT AS SIGNED) AS NENMATKBN, FILLER01, CAST(SYORIB AS SIGNED) AS SYORIDT, CAST(YOUBI AS SIGNED) AS SYORI_YOUBI, CAST(TYUKAIS AS SIGNED) AS TYUSTDT, CAST(TYUSYUR AS SIGNED) AS TYUEDDT, CAST(TOKKAIS AS SIGNED) AS TOKSTDT, CAST(TOKSYUR AS SIGNED) AS TOKEDDT, CAST(TDATE01 AS SIGNED) AS TDATE01, CAST(TYOUBI01 AS SIGNED) AS TYOUBI01, CAST(TDATE02 AS SIGNED) AS TDATE02, CAST(TYOUBI02 AS SIGNED) AS TYOUBI02, CAST(TDATE03 AS SIGNED) AS TDATE03, CAST(TYOUBI03 AS SIGNED) AS TYOUBI03, CAST(TDATE04 AS SIGNED) AS TDATE04, CAST(TYOUBI04 AS SIGNED) AS TYOUBI04, CAST(TDATE05 AS SIGNED) AS TDATE05, CAST(TYOUBI05 AS SIGNED) AS TYOUBI05, CAST(TDATE06 AS SIGNED) AS TDATE06, CAST(TYOUBI06 AS SIGNED) AS TYOUBI06, CAST(TDATE07 AS SIGNED) AS TDATE07, CAST(TYOUBI07 AS SIGNED) AS TYOUBI07, CAST(TDATE08 AS SIGNED) AS TDATE08, CAST(TYOUBI08 AS SIGNED) AS TYOUBI08, CAST(TDATE09 AS SIGNED) AS TDATE09, CAST(TYOUBI09 AS SIGNED) AS TYOUBI09, CAST(TDATE10 AS SIGNED) AS TDATE10, CAST(TYOUBI10 AS SIGNED) AS TYOUBI10, CAST(HACKAIS AS SIGNED) AS HACKAIS, CAST(HACSYUR AS SIGNED) AS HACSYUR, CAST(HDATE01 AS SIGNED) AS HDATE01, CAST(HYOUBI01 AS SIGNED) AS HYOUBI01, CAST(HDATE02 AS SIGNED) AS HDATE02, CAST(HYOUBI02 AS SIGNED) AS HYOUBI02, CAST(HDATE03 AS SIGNED) AS HDATE03, CAST(HYOUBI03 AS SIGNED) AS HYOUBI03, CAST(HDATE04 AS SIGNED) AS HDATE04, CAST(HYOUBI04 AS SIGNED) AS HYOUBI04, CAST(HDATE05 AS SIGNED) AS HDATE05, CAST(HYOUBI05 AS SIGNED) AS HYOUBI05, CAST(HDATE06 AS SIGNED) AS HDATE06, CAST(HYOUBI06 AS SIGNED) AS HYOUBI06, CAST(HDATE07 AS SIGNED) AS HDATE07, CAST(HYOUBI07 AS SIGNED) AS HYOUBI07, CAST(HDATE08 AS SIGNED) AS HDATE08, CAST(HYOUBI08 AS SIGNED) AS HYOUBI08, CAST(HDATE09 AS SIGNED) AS HDATE09, CAST(HYOUBI09 AS SIGNED) AS HYOUBI09, CAST(HDATE10 AS SIGNED) AS HDATE10, CAST(HYOUBI10 AS SIGNED) AS HYOUBI10, CAST(HDATE11 AS SIGNED) AS HDATE11, CAST(HYOUBI11 AS SIGNED) AS HYOUBI11, CAST(HDATE12 AS SIGNED) AS HDATE12, CAST(HYOUBI12 AS SIGNED) AS HYOUBI12, CAST(HDATE13 AS SIGNED) AS HDATE13, CAST(HYOUBI13 AS SIGNED) AS HYOUBI13, CAST(HDATE14 AS SIGNED) AS HDATE14, CAST(HYOUBI14 AS SIGNED) AS HYOUBI14, CAST(HDATE15 AS SIGNED) AS HDATE15, CAST(HYOUBI15 AS SIGNED) AS HYOUBI15, CAST(HDATE16 AS SIGNED) AS HDATE16, CAST(HYOUBI16 AS SIGNED) AS HYOUBI16, CAST(LISTNO AS SIGNED) AS LSTNO, CAST(KOTYUKAB AS SIGNED) AS KOTYUSTDT, CAST(KOTYUSYUB AS SIGNED) AS KOTYUEDDT, CAST(SOUSIME AS SIGNED) AS SNDSIMEDT, CAST(KESKAB AS SIGNED) AS SHWSTDT, CAST(KESSYUB AS SIGNED) AS SHWEDDT, TITLE, CAST(JZNKSYHKB AS SIGNED) AS JZNKSYHKBN, CAST(SAKSEIB AS SIGNED) AS ADDDT, FILLER02 FROM INAIN.BFB00_SHIME) T1 ON DUPLICATE KEY UPDATE COPY = T1.COPY, SEQ = T1.SEQ, BMNCD = T1.BMNCD, TOK = T1.TOK, TEI = T1.TEI, JUKBN = T1.JUKBN, NENMATKBN = T1.NENMATKBN, FILLER01 = T1.FILLER01, SYORIDT = T1.SYORIDT, SYORI_YOUBI = T1.SYORI_YOUBI, TYUSTDT = T1.TYUSTDT, TYUEDDT = T1.TYUEDDT, TOKSTDT = T1.TOKSTDT, TOKEDDT = T1.TOKEDDT, TDATE01 = T1.TDATE01, TYOUBI01 = T1.TYOUBI01, TDATE02 = T1.TDATE02, TYOUBI02 = T1.TYOUBI02, TDATE03 = T1.TDATE03, TYOUBI03 = T1.TYOUBI03, TDATE04 = T1.TDATE04, TYOUBI04 = T1.TYOUBI04, TDATE05 = T1.TDATE05, TYOUBI05 = T1.TYOUBI05, TDATE06 = T1.TDATE06, TYOUBI06 = T1.TYOUBI06, TDATE07 = T1.TDATE07, TYOUBI07 = T1.TYOUBI07, TDATE08 = T1.TDATE08, TYOUBI08 = T1.TYOUBI08, TDATE09 = T1.TDATE09, TYOUBI09 = T1.TYOUBI09, TDATE10 = T1.TDATE10, TYOUBI10 = T1.TYOUBI10, HACKAIS = T1.HACKAIS, HACSYUR = T1.HACSYUR, HDATE01 = T1.HDATE01, HYOUBI01 = T1.HYOUBI01, HDATE02 = T1.HDATE02, HYOUBI02 = T1.HYOUBI02, HDATE03 = T1.HDATE03, HYOUBI03 = T1.HYOUBI03, HDATE04 = T1.HDATE04, HYOUBI04 = T1.HYOUBI04, HDATE05 = T1.HDATE05, HYOUBI05 = T1.HYOUBI05, HDATE06 = T1.HDATE06, HYOUBI06 = T1.HYOUBI06, HDATE07 = T1.HDATE07, HYOUBI07 = T1.HYOUBI07, HDATE08 = T1.HDATE08, HYOUBI08 = T1.HYOUBI08, HDATE09 = T1.HDATE09, HYOUBI09 = T1.HYOUBI09, HDATE10 = T1.HDATE10, HYOUBI10 = T1.HYOUBI10, HDATE11 = T1.HDATE11, HYOUBI11 = T1.HYOUBI11, HDATE12 = T1.HDATE12, HYOUBI12 = T1.HYOUBI12, HDATE13 = T1.HDATE13, HYOUBI13 = T1.HYOUBI13, HDATE14 = T1.HDATE14, HYOUBI14 = T1.HYOUBI14, HDATE15 = T1.HDATE15, HYOUBI15 = T1.HYOUBI15, HDATE16 = T1.HDATE16, HYOUBI16 = T1.HYOUBI16, LSTNO = T1.LSTNO, KOTYUSTDT = T1.KOTYUSTDT, KOTYUEDDT = T1.KOTYUEDDT, SNDSIMEDT = T1.SNDSIMEDT, SHWSTDT = T1.SHWSTDT, SHWEDDT = T1.SHWEDDT, TITLE = T1.TITLE, JZNKSYHKBN = T1.JZNKSYHKBN, ADDDT = T1.ADDDT, FILLER02 = T1.FILLER02;COMMIT;" >>%OUTFILE% 2>&1

"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% --show-warnings -vv -e "ANALYZE TABLE INAIF.JH_SHIME_DATE;" >>%OUTFILE% 2>&1
IF NOT %ERRORLEVEL%==0 GOTO ERROR

:FINAL
EXIT /B 0

:ERROR
EXIT /B 1
