TRUNCATE TABLE INAWK.ANWK01_AF;
INSERT IGNORE INTO INAWK.ANWK01_AF WITH TGTG AS (SELECT * FROM INATK2.TOKTG_TENGP TGTG WHERE TGTG.UPDKBN <> 1), TGTEN AS (SELECT TGTEN.MOYSKBN, TGTEN.MOYSSTDT, TGTEN.MOYSRBAN, TGTEN.TENCD, TGTEN.TENGPCD, TGTG.QASYUKBN, TGTEN.KYOSEIFLG, TGTEN.LDTENKBN FROM INATK2.TOKTG_TEN TGTEN LEFT OUTER JOIN TGTG ON TGTG.MOYSKBN = TGTEN.MOYSKBN AND TGTG.MOYSSTDT = TGTEN.MOYSSTDT AND TGTG.MOYSRBAN = TGTEN.MOYSRBAN AND TGTG.TENGPCD = TGTEN.TENGPCD), TGSHN AS (SELECT WK08.MOYSCD, WK08.MOYSKBN, WK08.MOYSSTDT, WK08.MOYSRBAN, WK08.BMNCD, WK08.KANRINO, WK08.KANRIENO, WK08.TENCD, WK08.BMNO, WK08.MOHBSTDT, WK08.MOHBEDDT, WK08.HBOKUREFLG, WK08.JLSTCREDT, WK08.QADEVSTDT, WK08.QADEVENDFLG, WK08.TENGPCD, WK08.KYOSEIFLG, WK08.SHNCD, WK08.ADDSHUKBN, WK08.HBSTDT, WK08.HBEDDT, WK08.REIDMYKBN, WK08.HBSLIDE, WK08.GENKAAM, WK08.GENKARITU, WK08.A_BAIKAAM, WK08.B_BAIKAAM, WK08.C_BAIKAAM, WK08.A_GENKAAM_1KG, WK08.B_GENKAAM_1KG, WK08.C_GENKAAM_1KG, WK08.A_WRITUKBN, WK08.B_WRITUKBN, WK08.C_WRITUKBN, WK08.TKANPLUKBN, WK08.KO_A_BAIKAAN, WK08.BD1_A_BAIKAAN, WK08.BD2_A_BAIKAAN, WK08.KO_B_BAIKAAN, WK08.BD1_B_BAIKAAN, WK08.BD2_B_BAIKAAN, WK08.KO_C_BAIKAAN, WK08.BD1_C_BAIKAAN, WK08.BD2_C_BAIKAAN, WK08.PLUSNDFLG, WK08.TEIKEIKBN, WK08.SOURCEKBN1, WK08.SRCCD1, WK08.SOURCEKBN2, WK08.SRCCD2, WK08.URICD, WK08.QASYUKBN, WK08.LTENSAIFLG, WK08.HBSTRTFLG, WK08.TENSAIFLG, WK08.URIASELKBN, WK08.ITMSELKBN, WK08.CBAIKA, WK08.SBAIBL1, WK08.SBAIBL2, CASE WHEN WK08.MOYSKBN_SHN IS NOT NULL THEN WK08.CBAIKA * 10 ELSE CASE WHEN WK08.QASYUKBN_WK01 IN (4, 5) AND WK08.TKANPLUKBN = 1 THEN CASE WHEN WK08.QASYUKBN_WK01 IN (1, 4) THEN CASE WHEN WK08.URIASELKBN = 1 THEN WK08.BD2_A_BAIKAAN WHEN WK08.URIASELKBN = 2 THEN WK08.BD2_B_BAIKAAN WHEN WK08.URIASELKBN = 3 THEN WK08.BD2_C_BAIKAAN END WHEN WK08.QASYUKBN_WK01 IN (2, 3) THEN CASE WHEN WK08.BD2_C_BAIKAAN IS NOT NULL THEN CASE WHEN WK08.BD2_C_BAIKAAN > WK08.BD2_B_BAIKAAN THEN WK08.BD2_B_BAIKAAN WHEN WK08.BD2_C_BAIKAAN > WK08.BD2_A_BAIKAAN THEN WK08.BD2_A_BAIKAAN ELSE WK08.BD2_C_BAIKAAN END WHEN WK08.BD2_B_BAIKAAN IS NOT NULL THEN CASE WHEN WK08.BD2_B_BAIKAAN > WK08.BD2_A_BAIKAAN THEN WK08.BD2_A_BAIKAAN ELSE WK08.BD2_B_BAIKAAN END ELSE WK08.BD2_A_BAIKAAN END END ELSE 0 END END AS CBAIKAKG, WK08.DATAKBN, WK08.GTSIMECHGKBN, WK08.GTSIMEOKFLG, WK08.SENDFLG, WK08.UPDKBN, CAST(WK08.HBSTDT AS DATETIME) AS HBSTDT_TODT, CAST(WK08.HBEDDT AS DATETIME) AS HBEDDT_TODT FROM (SELECT WK08.MOYSCD, WK08.MOYSKBN, WK08.MOYSSTDT, WK08.MOYSRBAN, WK08.BMNO, WK08.MOHBSTDT, WK08.MOHBEDDT, WK08.HBOKUREFLG, WK08.JLSTCREDT, WK08.QADEVSTDT, WK08.QADEVENDFLG, WK08.TENGPCD, WK08.KYOSEIFLG, WK08.KANRINO, WK08.KANRIENO, WK08.BMNCD, WK08.SHNCD, WK08.ADDSHUKBN, WK08.HBSTDT, WK08.HBEDDT, WK08.REIDMYKBN, WK08.HBSLIDE, WK08.GENKAAM, WK08.GENKARITU, WK08.A_BAIKAAM, WK08.B_BAIKAAM, WK08.C_BAIKAAM, WK08.A_GENKAAM_1KG, WK08.B_GENKAAM_1KG, WK08.C_GENKAAM_1KG, WK08.A_WRITUKBN, WK08.B_WRITUKBN, WK08.C_WRITUKBN, WK08.TKANPLUKBN, WK08.KO_A_BAIKAAN, WK08.BD1_A_BAIKAAN, WK08.BD2_A_BAIKAAN, WK08.KO_B_BAIKAAN, WK08.BD1_B_BAIKAAN, WK08.BD2_B_BAIKAAN, WK08.KO_C_BAIKAAN, WK08.BD1_C_BAIKAAN, WK08.BD2_C_BAIKAAN, WK08.PLUSNDFLG, WK08.TEIKEIKBN, WK08.SOURCEKBN1, WK08.SRCCD1, WK08.SOURCEKBN2, WK08.SRCCD2, WK08.URICD, WK08.TENCD, WK08.QASYUKBN, WK08.LTENSAIFLG, WK08.HBSTRTFLG, WK08.TENSAIFLG, WK08.URIASELKBN, WK08.ITMSELKBN, CASE WHEN WK08.MOYSKBN_SHN IS NOT NULL AND WK08.QASYUKBN_WK01 IN (1, 2, 4) THEN CASE WHEN WK08.URIASELKBN = 1 THEN CASE WHEN WK08.KO_A_BAIKAAN = 0 THEN WK08.A_BAIKAAM WHEN WK08.KO_A_BAIKAAN <> 0 THEN WK08.KO_A_BAIKAAN END WHEN WK08.URIASELKBN = 2 THEN CASE WHEN WK08.KO_B_BAIKAAN = 0 THEN WK08.B_BAIKAAM WHEN WK08.KO_B_BAIKAAN <> 0 THEN WK08.KO_B_BAIKAAN END WHEN WK08.URIASELKBN = 3 THEN CASE WHEN WK08.KO_C_BAIKAAN = 0 THEN WK08.C_BAIKAAM WHEN WK08.KO_C_BAIKAAN <> 0 THEN WK08.KO_C_BAIKAAN END END WHEN WK08.MOYSKBN_SHN IS NOT NULL AND WK08.QASYUKBN_WK01 = 3 THEN WK08.URICHGAM1 WHEN WK08.MOYSKBN_SHN IS NOT NULL AND WK08.QASYUKBN_WK01 = 5 THEN WK08.CBAIKA_WK01 WHEN WK08.MOYSKBN_SHN IS NULL AND WK08.QASYUKBN_WK01 IN (1, 4) THEN CASE WHEN WK08.URIASELKBN = 1 THEN CASE WHEN WK08.KO_A_BAIKAAN = 0 THEN WK08.A_BAIKAAM WHEN WK08.KO_A_BAIKAAN <> 0 THEN WK08.KO_A_BAIKAAN END WHEN WK08.URIASELKBN = 2 THEN CASE WHEN WK08.KO_B_BAIKAAN = 0 THEN WK08.B_BAIKAAM WHEN WK08.KO_B_BAIKAAN <> 0 THEN WK08.KO_B_BAIKAAN END WHEN WK08.URIASELKBN = 3 THEN CASE WHEN WK08.KO_C_BAIKAAN = 0 THEN WK08.C_BAIKAAM WHEN WK08.KO_C_BAIKAAN <> 0 THEN WK08.KO_C_BAIKAAN END END WHEN WK08.MOYSKBN_SHN IS NULL AND WK08.QASYUKBN_WK01 IN (2, 3) THEN CASE WHEN WK08.KO_C_BAIKAAN IS NOT NULL THEN CASE WHEN WK08.KO_C_BAIKAAN > WK08.KO_B_BAIKAAN THEN WK08.KO_B_BAIKAAN WHEN WK08.KO_C_BAIKAAN > WK08.KO_A_BAIKAAN THEN WK08.KO_A_BAIKAAN ELSE WK08.KO_C_BAIKAAN END WHEN WK08.KO_B_BAIKAAN IS NOT NULL THEN CASE WHEN WK08.KO_B_BAIKAAN > WK08.KO_A_BAIKAAN THEN WK08.KO_A_BAIKAAN ELSE WK08.KO_B_BAIKAAN END ELSE WK08.KO_A_BAIKAAN END END AS CBAIKA, CASE WHEN WK08.MOYSKBN_SHN IS NOT NULL AND WK08.QASYUKBN_WK01 IN (1, 2, 4) THEN CASE WHEN WK08.URIASELKBN = 1 THEN WK08.BD1_A_BAIKAAN WHEN WK08.URIASELKBN = 2 THEN WK08.BD1_B_BAIKAAN WHEN WK08.URIASELKBN = 3 THEN WK08.BD1_C_BAIKAAN END WHEN WK08.MOYSKBN_SHN IS NOT NULL AND WK08.QASYUKBN_WK01 = 3 THEN WK08.URICHGAM2 WHEN WK08.MOYSKBN_SHN IS NOT NULL AND WK08.QASYUKBN_WK01 = 5 THEN WK08.SBAIBL1_WK01 WHEN WK08.MOYSKBN_SHN IS NULL AND WK08.QASYUKBN_WK01 IN (1, 4) THEN CASE WHEN WK08.URIASELKBN = 1 THEN WK08.BD1_A_BAIKAAN WHEN WK08.URIASELKBN = 2 THEN WK08.BD1_B_BAIKAAN WHEN WK08.URIASELKBN = 3 THEN WK08.BD1_C_BAIKAAN END WHEN WK08.MOYSKBN_SHN IS NOT NULL AND WK08.QASYUKBN_WK01 IN (2, 3) THEN CASE WHEN WK08.BD1_C_BAIKAAN IS NOT NULL THEN CASE WHEN WK08.BD1_C_BAIKAAN > WK08.BD1_B_BAIKAAN THEN WK08.BD1_B_BAIKAAN WHEN WK08.BD1_C_BAIKAAN > WK08.BD1_A_BAIKAAN THEN WK08.BD1_A_BAIKAAN ELSE WK08.BD1_C_BAIKAAN END WHEN WK08.BD1_B_BAIKAAN IS NOT NULL THEN CASE WHEN WK08.BD1_B_BAIKAAN > WK08.BD1_A_BAIKAAN THEN WK08.BD1_A_BAIKAAN ELSE WK08.BD1_B_BAIKAAN END ELSE WK08.BD1_A_BAIKAAN END END AS SBAIBL1, CASE WHEN WK08.MOYSKBN_SHN IS NOT NULL AND WK08.QASYUKBN_WK01 IN (1, 2, 4) THEN CASE WHEN WK08.URIASELKBN = 1 THEN WK08.BD2_A_BAIKAAN WHEN WK08.URIASELKBN = 2 THEN WK08.BD2_B_BAIKAAN WHEN WK08.URIASELKBN = 3 THEN WK08.BD2_C_BAIKAAN END WHEN WK08.MOYSKBN_SHN IS NOT NULL AND WK08.QASYUKBN_WK01 = 3 THEN WK08.URICHGAM3 WHEN WK08.MOYSKBN_SHN IS NOT NULL AND WK08.QASYUKBN_WK01 = 5 THEN WK08.SBAIBL2_WK01 WHEN WK08.MOYSKBN_SHN IS NULL AND WK08.QASYUKBN_WK01 IN (1, 4) THEN CASE WHEN WK08.URIASELKBN = 1 THEN WK08.BD2_A_BAIKAAN WHEN WK08.URIASELKBN = 2 THEN WK08.BD2_B_BAIKAAN WHEN WK08.URIASELKBN = 3 THEN WK08.BD2_C_BAIKAAN END WHEN WK08.MOYSKBN_SHN IS NOT NULL AND WK08.QASYUKBN_WK01 IN (2, 3) THEN CASE WHEN WK08.BD2_C_BAIKAAN IS NOT NULL THEN CASE WHEN WK08.BD2_C_BAIKAAN > WK08.BD2_B_BAIKAAN THEN WK08.BD2_B_BAIKAAN WHEN WK08.BD2_C_BAIKAAN > WK08.BD2_A_BAIKAAN THEN WK08.BD2_A_BAIKAAN ELSE WK08.BD2_C_BAIKAAN END WHEN WK08.BD2_B_BAIKAAN IS NOT NULL THEN CASE WHEN WK08.BD2_B_BAIKAAN > WK08.BD2_A_BAIKAAN THEN WK08.BD2_A_BAIKAAN ELSE WK08.BD2_B_BAIKAAN END ELSE WK08.BD2_A_BAIKAAN END END AS SBAIBL2, WK08.MOYSKBN_SHN, WK08.QASYUKBN_WK01, WK08.DATAKBN, WK08.GTSIMECHGKBN, WK08.GTSIMEOKFLG, WK08.SENDFLG, WK08.UPDKBN FROM (SELECT WK01.MOYSCD, WK01.MOYSKBN, WK01.MOYSSTDT, WK01.MOYSRBAN, WK01.BMNO, WK01.MOHBSTDT, WK01.MOHBEDDT, WK01.HBOKUREFLG, WK01.JLSTCREDT, WK01.QADEVSTDT, WK01.QADEVENDFLG, WK01.TENGPCD, WK01.KYOSEIFLG, WK01.KANRINO, WK01.KANRIENO, WK01.BMNCD, WK01.SHNCD, WK01.ADDSHUKBN, WK01.HBSTDT, WK01.HBEDDT, WK01.REIDMYKBN, WK01.HBSLIDEFLG AS HBSLIDE, WK01.GENKAAM, WK01.GENKARITU, WK01.A_BAIKAAM, WK01.B_BAIKAAM, WK01.C_BAIKAAM, WK01.A_GENKAAM_1KG, WK01.B_GENKAAM_1KG, WK01.C_GENKAAM_1KG, WK01.A_WRITUKBN, WK01.B_WRITUKBN, WK01.C_WRITUKBN, WK01.TKANPLUKBN, WK01.KO_A_BAIKAAN, WK01.BD1_A_BAIKAAN, WK01.BD2_A_BAIKAAN, WK01.KO_B_BAIKAAN, WK01.BD1_B_BAIKAAN, WK01.BD2_B_BAIKAAN, WK01.KO_C_BAIKAAN, WK01.BD1_C_BAIKAAN, WK01.BD2_C_BAIKAAN, WK01.PLUSNDFLG, WK01.TEIKEIKBN, WK01.SOURCEKBN1, WK01.SRCCD1, WK01.SOURCEKBN2, WK01.SRCCD2, WK01.URICD, WK01.TENCD, WK01.QASYUKBN, CASE WHEN QATEN.MOYSKBN IS NOT NULL THEN QATEN.LDTENKBN ELSE WK01.LTENSAIFLG END AS LTENSAIFLG, CASE WHEN QATEN.MOYSKBN IS NOT NULL THEN QATEN.HBSTRTFLG ELSE WK01.HANKAISIFLG END AS HBSTRTFLG, CASE WHEN QATEN.MOYSKBN IS NOT NULL THEN CASE WHEN QATEN.LDTENKBN = 0 THEN CASE WHEN QATEN.MBSYFLG = 1 THEN 1 WHEN QATEN.MBSYFLG = 2 THEN 0 END WHEN QATEN.LDTENKBN = 1 THEN CASE WHEN QATEN.MBSYFLG = 1 THEN 2 WHEN QATEN.MBSYFLG = 2 THEN 3 END END ELSE WK01.TENSAIFLG END AS TENSAIFLG, CASE WHEN QASHN.MOYSKBN IS NOT NULL AND QAGP.QASYUKBN = 2 THEN QASHN.URISELKBN WHEN QAGP.MOYSKBN IS NOT NULL THEN CASE WHEN QAGP.QASYUKBN IN (1, 4) THEN QAGP.URIASELKBN WHEN QAGP.QASYUKBN = 3 THEN 4 END ELSE WK01.URIASELKBN END AS URIASELKBN, CASE WHEN QASHN.MOYSKBN IS NOT NULL AND WK01.QASYUKBN = 4 THEN CASE WHEN QASHN.ITMSELKBN = 0 THEN 2 ELSE 1 END ELSE WK01.ITMSELKBN END AS ITMSELKBN, QASHN.MOYSKBN AS MOYSKBN_SHN, QASHN.URICHGAM1, QASHN.URICHGAM2, QASHN.URICHGAM3, WK01.QASYUKBN AS QASYUKBN_WK01, WK01.CBAIKA AS CBAIKA_WK01, WK01.SBAIBL1 AS SBAIBL1_WK01, WK01.SBAIBL2 AS SBAIBL2_WK01, WK01.DATAKBN, WK01.GTSIMECHGKBN, WK01.GTSIMEOKFLG, WK01.SENDFLG, WK01.UPDKBN FROM INAIF.AN_HANBAI_BFR WK01 LEFT OUTER JOIN INATK2.TOKTG_QATEN QATEN ON WK01.MOYSKBN = QATEN.MOYSKBN AND WK01.MOYSSTDT = QATEN.MOYSSTDT AND WK01.MOYSRBAN = QATEN.MOYSRBAN AND WK01.TENGPCD = QATEN.TENGPCD AND WK01.TENCD = QATEN.TENCD LEFT OUTER JOIN INATK2.TOKTG_QAGP QAGP ON WK01.MOYSKBN = QAGP.MOYSKBN AND WK01.MOYSSTDT = QAGP.MOYSSTDT AND WK01.MOYSRBAN = QAGP.MOYSRBAN AND WK01.TENGPCD = QAGP.TENGPCD LEFT OUTER JOIN INATK2.TOKTG_QASHN QASHN ON WK01.MOYSKBN = QASHN.MOYSKBN AND WK01.MOYSSTDT = QASHN.MOYSSTDT AND WK01.MOYSRBAN = QASHN.MOYSRBAN AND WK01.TENGPCD = QASHN.TENGPCD AND WK01.BMNCD = QASHN.BMNCD AND WK01.KANRINO = QASHN.KANRINO) WK08) WK08) SELECT TGSHN.MOYSKBN, TGSHN.MOYSSTDT, TGSHN.MOYSRBAN, TGSHN.BMNO, TGSHN.MOHBSTDT, TGSHN.MOHBEDDT, TGSHN.HBOKUREFLG, TGSHN.JLSTCREDT, TGSHN.QADEVSTDT, TGSHN.QADEVENDFLG, TGTEN.TENGPCD, TGTEN.KYOSEIFLG, TGSHN.KANRINO, TGSHN.KANRIENO, TGSHN.BMNCD, TGSHN.SHNCD, TGSHN.ADDSHUKBN, TGSHN.HBSTDT, TGSHN.HBEDDT, TGSHN.REIDMYKBN, TGSHN.HBSLIDE, TGSHN.GENKAAM, TGSHN.GENKARITU, TGSHN.A_BAIKAAM, TGSHN.B_BAIKAAM, TGSHN.C_BAIKAAM, TGSHN.A_GENKAAM_1KG, TGSHN.B_GENKAAM_1KG, TGSHN.C_GENKAAM_1KG, TGSHN.A_WRITUKBN, TGSHN.B_WRITUKBN, TGSHN.C_WRITUKBN, TGSHN.TKANPLUKBN, TGSHN.KO_A_BAIKAAN, TGSHN.BD1_A_BAIKAAN, TGSHN.BD2_A_BAIKAAN, TGSHN.KO_B_BAIKAAN, TGSHN.BD1_B_BAIKAAN, TGSHN.BD2_B_BAIKAAN, TGSHN.KO_C_BAIKAAN, TGSHN.BD1_C_BAIKAAN, TGSHN.BD2_C_BAIKAAN, TGSHN.PLUSNDFLG, TGSHN.TEIKEIKBN, TGSHN.SOURCEKBN1, TGSHN.SRCCD1, TGSHN.SOURCEKBN2, TGSHN.SRCCD2, TGSHN.URICD, TGTEN.TENCD, CASE WHEN TSTEN.TENCD IS NULL THEN NULL ELSE TGSHN.HBSTDT_TODT END AS HBDT1, CASE WHEN TSTEN.TENCD IS NULL THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 1 DAY, '%Y%m%d') AS SIGNED) > TGSHN.HBEDDT THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 1 DAY, '%Y%m%d') AS SIGNED) = TGSHN.HBEDDT THEN TGSHN.HBEDDT_TODT ELSE TGSHN.HBSTDT_TODT + INTERVAL 1 DAY END AS HBDT2, CASE WHEN TSTEN.TENCD IS NULL THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 2 DAY, '%Y%m%d') AS SIGNED) > TGSHN.MOHBEDDT THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 2 DAY, '%Y%m%d') AS SIGNED) = TGSHN.MOHBEDDT THEN TGSHN.HBEDDT_TODT ELSE TGSHN.HBSTDT_TODT + INTERVAL 2 DAY END AS HBDT3, CASE WHEN TSTEN.TENCD IS NULL THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 3 DAY, '%Y%m%d') AS SIGNED) > TGSHN.MOHBEDDT THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 3 DAY, '%Y%m%d') AS SIGNED) = TGSHN.MOHBEDDT THEN TGSHN.HBEDDT_TODT ELSE TGSHN.HBSTDT_TODT + INTERVAL 3 DAY END AS HBDT4, CASE WHEN TSTEN.TENCD IS NULL THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 4 DAY, '%Y%m%d') AS SIGNED) > TGSHN.MOHBEDDT THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 4 DAY, '%Y%m%d') AS SIGNED) = TGSHN.MOHBEDDT THEN TGSHN.HBEDDT_TODT ELSE TGSHN.HBSTDT_TODT + INTERVAL 4 DAY END AS HBDT5, CASE WHEN TSTEN.TENCD IS NULL THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 5 DAY, '%Y%m%d') AS SIGNED) > TGSHN.MOHBEDDT THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 5 DAY, '%Y%m%d') AS SIGNED) = TGSHN.MOHBEDDT THEN TGSHN.HBEDDT_TODT ELSE TGSHN.HBSTDT_TODT + INTERVAL 5 DAY END AS HBDT6, CASE WHEN TSTEN.TENCD IS NULL THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 6 DAY, '%Y%m%d') AS SIGNED) > TGSHN.MOHBEDDT THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 6 DAY, '%Y%m%d') AS SIGNED) = TGSHN.MOHBEDDT THEN TGSHN.HBEDDT_TODT ELSE TGSHN.HBSTDT_TODT + INTERVAL 6 DAY END AS HBDT7, CASE WHEN TSTEN.TENCD IS NULL THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 7 DAY, '%Y%m%d') AS SIGNED) > TGSHN.MOHBEDDT THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 7 DAY, '%Y%m%d') AS SIGNED) = TGSHN.MOHBEDDT THEN TGSHN.HBEDDT_TODT ELSE TGSHN.HBSTDT_TODT + INTERVAL 7 DAY END AS HBDT8, CASE WHEN TSTEN.TENCD IS NULL THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 8 DAY, '%Y%m%d') AS SIGNED) > TGSHN.MOHBEDDT THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 8 DAY, '%Y%m%d') AS SIGNED) = TGSHN.MOHBEDDT THEN TGSHN.HBEDDT_TODT ELSE TGSHN.HBSTDT_TODT + INTERVAL 8 DAY END AS HBDT9, CASE WHEN TSTEN.TENCD IS NULL THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 9 DAY, '%Y%m%d') AS SIGNED) > TGSHN.MOHBEDDT THEN NULL WHEN CAST(DATE_FORMAT(TGSHN.HBSTDT_TODT + INTERVAL 9 DAY, '%Y%m%d') AS SIGNED) = TGSHN.MOHBEDDT THEN TGSHN.HBEDDT_TODT ELSE TGSHN.HBSTDT_TODT + INTERVAL 9 DAY END AS HBDT10, TGTEN.QASYUKBN, TGSHN.LTENSAIFLG, TGSHN.HBSTRTFLG AS HANKAISIFLG, TGSHN.TENSAIFLG, TGSHN.URIASELKBN, TGSHN.ITMSELKBN AS SHOHINSEL, TGSHN.CBAIKA, TGSHN.SBAIBL1, TGSHN.SBAIBL2, TGSHN.CBAIKAKG, TGSHN.DATAKBN, TGSHN.GTSIMECHGKBN, TGSHN.GTSIMEOKFLG, TGSHN.SENDFLG, TGSHN.UPDKBN FROM TGSHN INNER JOIN TGTEN ON TGSHN.MOYSKBN = TGTEN.MOYSKBN AND TGSHN.MOYSSTDT = TGTEN.MOYSSTDT AND TGSHN.MOYSRBAN = TGTEN.MOYSRBAN AND TGSHN.TENCD = TGTEN.TENCD LEFT OUTER JOIN INAWK.ANWK_A11TC44 TSTEN ON TGSHN.MOYSKBN = TSTEN.MOYSKBN AND TGSHN.MOYSSTDT = TSTEN.MOYSSTDT AND TGSHN.MOYSRBAN = TSTEN.MOYSRBAN AND TGSHN.BMNCD = TSTEN.BMNCD AND TGSHN.KANRINO = TSTEN.KANRINO AND TGSHN.KANRIENO = TSTEN.KANRIENO AND TGSHN.TENCD = TSTEN.TENCD WHERE TGSHN.HBSTDT >= (SELECT SBD.DT_INT FROM INAPARM.SYSBATCHDT_TK SBD WHERE SBD.SMODE = 'DAILY') AND TGSHN.UPDKBN <> 1;
COMMIT;
ANALYZE TABLE INAWK.ANWK01_AF;
COMMIT;
