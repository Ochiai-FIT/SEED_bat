/*定量特売納入日データ(ア有)*/ 
TRUNCATE TABLE INAWK.ANWK13_TC18_A;
INSERT IGNORE INTO INAWK.ANWK13_TC18_A SELECT SUBSTR(NOU.SHNCD, 1, 8), SUBSTR(NOU.SHNCD, 9, 6), CASE WHEN NOU.MOYSKBN IN (0, 5) THEN 0 WHEN NOU.MOYSKBN IN (1, 3, 4) THEN 1 ELSE 2 END, CASE WHEN HAN.MOYSKBN IS NULL THEN NOU.BINKBN WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN NOU.BINKBN END, CASE WHEN HAN.MOYSKBN IS NULL THEN NOU.NNSTDT WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN NOU.NNSTDT END, CASE WHEN HAN.MOYSKBN IS NULL THEN NOU.NNEDDT WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN NOU.NNEDDT END, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN DATE_FORMAT(HAN.HBSTDT_SL, '%Y%m%d') END, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN DATE_FORMAT(HAN.HBEDDT_SL, '%Y%m%d') END, CASE WHEN HAN.MOYSKBN IS NULL THEN NOU.NNDT WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN NOU.NNDT END, CASE WHEN HAN.MOYSKBN IS NULL THEN WEEKDAY(DATE_FORMAT(NOU.NNDT, '%Y%m%d')) + 1 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN WEEKDAY(DATE_FORMAT(NOU.NNDT, '%Y%m%d')) + 1 END, 0, 0, 0, 0, 0, 0, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN HAN.A_BAIKAAM END, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN HAN.B_BAIKAAM END, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN CASE WHEN HAN.ADDSHUKBN IN (4, 5) AND HAN.TKANPLUKBN = 2 THEN HAN.CBAIKA ELSE HAN.CBAIKAKG END WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN HAN.C_BAIKAAM END, 0, 0, 0, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL THEN HAN.A_GENKAAM_1KG END, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL THEN HAN.B_GENKAAM_1KG END, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL THEN HAN.C_GENKAAM_1KG END, 0, 0, 0, 0, 0, 0, 0, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN CASE WHEN HAN.ADDSHUKBN = 1 THEN HAN.A_WRITUKBN ELSE HAN.KO_A_BAIKAAN END END, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN HAN.BD1_A_BAIKAAN END, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN HAN.BD2_A_BAIKAAN END, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN CASE WHEN HAN.ADDSHUKBN = 1 THEN HAN.B_WRITUKBN ELSE HAN.KO_B_BAIKAAN END END, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN HAN.BD1_B_BAIKAAN END, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN HAN.BD2_B_BAIKAAN END, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN CASE WHEN HAN.ADDSHUKBN = 1 THEN HAN.C_WRITUKBN ELSE HAN.KO_C_BAIKAAN END END, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN HAN.BD1_C_BAIKAAN END, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN HAN.BD2_C_BAIKAAN END, 0, CASE WHEN HAN.MOYSKBN IS NULL THEN NOU.NENMATKBN WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN NOU.NENMATKBN END, CASE WHEN HAN.MOYSKBN IS NULL THEN CAST(NOU.TSEIKBN AS CHAR (1)) WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN '0' WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN CAST(NOU.TSEIKBN AS CHAR (1)) END, 0, 1, CASE WHEN NOU.MOYSKBN in (3, 4) THEN 2 ELSE 1 END, CASE WHEN HAN.MOYSKBN IS NULL THEN 0 WHEN HAN.MOYSKBN IS NOT NULL THEN HAN.TKANPLUKBN END, 0, '', '', CASE WHEN HAN.MOYSKBN IS NULL THEN NOU.JUFLG WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN NOU.JUFLG END, CASE WHEN HAN.MOYSKBN IS NULL THEN NOU.SHUDENFLG WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN NOU.SHUDENFLG END, 0, 0, 0, 0, 0, 0, CASE WHEN HAN.MOYSKBN IS NULL THEN NOU.REIDMYKBN WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 ELSE NOU.REIDMYKBN END, 0, 0, 0, 0, 0, 0, '', '', '', '', '', '', '', '', 0, CASE WHEN HAN.MOYSKBN IS NULL THEN NOU.BMNCD WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN NOU.BMNCD END, 0, 0, 0, 0, 0, 0, '', '', 0, NOU.MOYSKBN, NOU.MOYSSTDT, NOU.MOYSRBAN, NOU.BMNCD, NOU.KANRINO, NOU.KANRIENO, NOU.SHUNO -- 中間では店別発注数のため、売価選択区分の判断せず
, NOU.TENCD, 0, 0, 0, 0, 0, 0, 0, 0, 0, null, 0, '', '', '', CASE WHEN HAN.MOYSKBN IS NULL THEN NOU.JUHTDT WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN NOU.JUHTDT END, CASE WHEN HAN.MOYSKBN IS NULL THEN NOU.JLSTCREDT WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN NOU.JLSTCREDT END, CASE WHEN HAN.MOYSKBN IS NULL THEN NOU.JHTSUINDT WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN NOU.JHTSUINDT END, CASE WHEN HAN.MOYSKBN IS NULL THEN NOU.WEEKHTDT WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN NOU.WEEKHTDT END, 0, CASE WHEN HAN.MOYSKBN IS NULL THEN CASE WHEN NOU.HSUU IS NULL THEN 999999 ELSE NOU.HSUU END WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 0 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN CASE WHEN NOU.HSUU IS NULL THEN 999999 ELSE NOU.HSUU END END, CASE WHEN HAN.MOYSKBN IS NULL THEN '' WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN '' WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN HAN.URIASELKBN END, '', SBD.DT_INT, CASE WHEN HAN.MOYSKBN IS NULL THEN 2 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN = 4 THEN 3 WHEN HAN.MOYSKBN IS NOT NULL AND HAN.URIASELKBN <> 4 THEN 1 END, HAN.ADDSHUKBN FROM (SELECT * FROM (SELECT * FROM INAIF.AN_NOUNYU_AFT UNION ALL SELECT * FROM INAIF.AN_ZW_NOUNYU_AFT) ANWK WHERE ANWK.NNDT >= (SELECT DATE_FORMAT(DATE_ADD(SBD.DT, INTERVAL - 10 DAY), '%Y%m%d') FROM INAPARM.SYSBATCHDT_TK SBD WHERE SMODE = 'DAILY' AND ACTIVEFLG = 1) AND NOT (ANWK.HSUU IS NULL AND ANWK.TSEIKBN IS NULL) AND EXISTS (SELECT * FROM INAWK.ANWK12_NOU_A WK12 WHERE ANWK.MOYSKBN = WK12.MOYSKBN AND ANWK.MOYSSTDT = WK12.MOYSSTDT AND ANWK.MOYSRBAN = WK12.MOYSRBAN AND ANWK.KANRINO = WK12.KANRINO AND ANWK.BMNCD = WK12.BMNCD AND ANWK.KANRIENO <= WK12.KANRIENO)) NOU LEFT OUTER JOIN INAWK.AN_HANBAI_AFT_WK1 HAN ON NOU.MOYSKBN = HAN.MOYSKBN AND NOU.MOYSSTDT = HAN.MOYSSTDT AND NOU.MOYSRBAN = HAN.MOYSRBAN AND NOU.BMNCD = HAN.BMNCD AND NOU.KANRINO = HAN.KANRINO AND NOU.KANRIENO = HAN.KANRIENO AND NOU.TENCD = HAN.TENCD --    AND NOU.HSUU IS NOT NULL
LEFT OUTER JOIN INAPARM.SYSBATCHDT_TK SBD ON SMODE = 'DAILY' AND ACTIVEFLG = 1;
ANALYZE TABLE INAWK.ANWK13_TC18_A;
commit;
