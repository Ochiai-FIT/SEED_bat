
TRUNCATE TABLE INAWK.D2WK28_ZZQ102_Z;
INSERT IGNORE INTO INAWK.D2WK28_ZZQ102_Z WITH WK28 AS (SELECT WK23.REC_HAN_KBN, WK23.MISE, WK23.SHOHNC, WK23.FILLER01, WK23.SYOKBN, WK23.BINK, WK23.NOKAIS, WK23.NOSYUR, WK23.HAKAIS, WK23.HASYUR, WK23.NNYNOB, WK23.NONYB, WK23.HACHBI, WK23.HACYB, CASE WHEN WK23.JZNGENKA = 0 THEN WK23.JZNGENKA WHEN WK24.MISE IS NULL THEN WK23.JZNGENKA WHEN WK23.SYOKBN <> 0 THEN WK23.JZNGENKA WHEN WK24.MSF = 'A' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.A_SOBAIFG THEN SHN.RG_GENKAAM ELSE WK24.GENKA END WHEN WK24.MSF = 'B' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.B_SOBAIFG THEN SHN.RG_GENKAAM ELSE WK24.GENKA END WHEN WK24.MSF = 'C' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.C_SOBAIFG THEN SHN.RG_GENKAAM ELSE WK24.GENKA END ELSE WK23.JZNGENKA END AS JZNGENKA, CASE WHEN WK23.TUIGENKA = 0 THEN WK23.TUIGENKA WHEN WK24.MISE IS NULL THEN WK23.TUIGENKA WHEN WK23.SYOKBN <> 0 THEN WK23.TUIGENKA WHEN WK24.MSF = 'A' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.A_SOBAIFG THEN SHN.RG_GENKAAM ELSE WK24.GENKA END WHEN WK24.MSF = 'B' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.B_SOBAIFG THEN SHN.RG_GENKAAM ELSE WK24.GENKA END WHEN WK24.MSF = 'C' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.C_SOBAIFG THEN SHN.RG_GENKAAM ELSE WK24.GENKA END ELSE WK23.TUIGENKA END AS TUIGENKA, CASE WHEN WK23.GENFU = 0 THEN WK23.GENFU WHEN WK24.MISE IS NULL THEN WK23.GENFU WHEN WK23.SYOKBN <> 0 THEN WK23.GENFU WHEN WK24.MSF = 'A' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.A_SOBAIFG THEN SHN.RG_GENKAAM ELSE WK24.GENKA END WHEN WK24.MSF = 'B' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.B_SOBAIFG THEN SHN.RG_GENKAAM ELSE WK24.GENKA END WHEN WK24.MSF = 'C' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.C_SOBAIFG THEN SHN.RG_GENKAAM ELSE WK24.GENKA END ELSE WK23.GENFU END AS GENFU, CASE WHEN WK23.GENFUK = 0 THEN WK23.GENFUK WHEN WK24.MISE IS NULL THEN WK23.GENFUK WHEN WK23.SYOKBN <> 0 THEN WK23.GENFUK WHEN WK24.MSF = 'A' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.A_SOBAIFG THEN SHN.RG_GENKAAM ELSE WK24.GENKA END WHEN WK24.MSF = 'B' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.B_SOBAIFG THEN SHN.RG_GENKAAM ELSE WK24.GENKA END WHEN WK24.MSF = 'C' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.C_SOBAIFG THEN SHN.RG_GENKAAM ELSE WK24.GENKA END ELSE WK23.GENFUK END AS GENFUK, CASE WHEN WK23.A_SOBAIFG = 0 THEN WK23.A_SOBAIFG WHEN WK24.MISE IS NULL THEN WK23.A_SOBAIFG WHEN WK23.SYOKBN <> 0 THEN WK23.A_SOBAIFG WHEN WK24.MSF = 'A' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.A_SOBAIFG THEN SHN.RG_BAIKAAM ELSE WK24.A_SOBAIFG END ELSE WK23.A_SOBAIFG END AS A_SOBAIFG, CASE WHEN WK23.B_SOBAIFG = 0 THEN WK23.B_SOBAIFG WHEN WK24.MISE IS NULL THEN WK23.B_SOBAIFG WHEN WK23.SYOKBN <> 0 THEN WK23.B_SOBAIFG WHEN WK24.MSF = 'B' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.B_SOBAIFG THEN SHN.RG_BAIKAAM ELSE WK24.B_SOBAIFG END ELSE WK23.B_SOBAIFG END AS B_SOBAIFG, CASE WHEN WK23.C_SOBAIFG = 0 THEN WK23.C_SOBAIFG WHEN WK24.MISE IS NULL THEN WK23.C_SOBAIFG WHEN WK23.SYOKBN <> 0 THEN WK23.C_SOBAIFG WHEN WK24.MSF = 'C' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.C_SOBAIFG THEN SHN.RG_BAIKAAM ELSE WK24.C_SOBAIFG END ELSE WK23.C_SOBAIFG END AS C_SOBAIFG, CASE WHEN WK23.A_SOBAIFP = 0 THEN WK23.A_SOBAIFP WHEN WK24.MISE IS NULL THEN WK23.A_SOBAIFP WHEN WK23.SYOKBN <> 0 THEN WK23.A_SOBAIFP WHEN WK24.MSF = 'A' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.A_SOBAIFG THEN SHN.RG_BAIKAAM ELSE WK24.A_SOBAIFG END ELSE WK23.A_SOBAIFP END AS A_SOBAIFP, CASE WHEN WK23.B_SOBAIFP = 0 THEN WK23.B_SOBAIFP WHEN WK24.MISE IS NULL THEN WK23.B_SOBAIFP WHEN WK23.SYOKBN <> 0 THEN WK23.B_SOBAIFP WHEN WK24.MSF = 'B' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.B_SOBAIFG THEN SHN.RG_BAIKAAM ELSE WK24.B_SOBAIFG END ELSE WK23.B_SOBAIFP END AS B_SOBAIFP, CASE WHEN WK23.C_SOBAIFP = 0 THEN WK23.C_SOBAIFP WHEN WK24.MISE IS NULL THEN WK23.C_SOBAIFP WHEN WK23.SYOKBN <> 0 THEN WK23.C_SOBAIFP WHEN WK24.MSF = 'C' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.C_SOBAIFG THEN SHN.RG_BAIKAAM ELSE WK24.C_SOBAIFG END ELSE WK23.C_SOBAIFP END AS C_SOBAIFP, CASE WHEN WK23.A_SOBAIFK = 0 THEN WK23.A_SOBAIFK WHEN WK24.MISE IS NULL THEN WK23.A_SOBAIFK WHEN WK23.SYOKBN <> 0 THEN WK23.A_SOBAIFK WHEN WK24.MSF = 'A' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.A_SOBAIFG THEN SHN.RG_BAIKAAM ELSE WK24.A_SOBAIFG END ELSE WK23.A_SOBAIFK END AS A_SOBAIFK, CASE WHEN WK23.B_SOBAIFK = 0 THEN WK23.B_SOBAIFK WHEN WK24.MISE IS NULL THEN WK23.B_SOBAIFK WHEN WK23.SYOKBN <> 0 THEN WK23.B_SOBAIFK WHEN WK24.MSF = 'B' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.B_SOBAIFG THEN SHN.RG_BAIKAAM ELSE WK24.B_SOBAIFG END ELSE WK23.B_SOBAIFK END AS B_SOBAIFK, CASE WHEN WK23.C_SOBAIFK = 0 THEN WK23.C_SOBAIFK WHEN WK24.MISE IS NULL THEN WK23.C_SOBAIFK WHEN WK23.SYOKBN <> 0 THEN WK23.C_SOBAIFK WHEN WK24.MSF = 'C' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.C_SOBAIFG THEN SHN.RG_BAIKAAM ELSE WK24.C_SOBAIFG END ELSE WK23.C_SOBAIFK END AS C_SOBAIFK, CASE WHEN WK23.A_BAIKA_SOTO = 0 THEN WK23.A_BAIKA_SOTO WHEN WK24.MISE IS NULL THEN WK23.A_BAIKA_SOTO WHEN WK23.SYOKBN <> 0 THEN WK23.A_BAIKA_SOTO WHEN WK24.MSF = 'A' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.A_SOBAIFG THEN SHN.RG_BAIKAAM ELSE WK24.A_SOBAIFG END ELSE WK23.A_BAIKA_SOTO END AS A_BAIKA_SOTO, CASE WHEN WK23.B_BAIKA_SOTO = 0 THEN WK23.B_BAIKA_SOTO WHEN WK24.MISE IS NULL THEN WK23.B_BAIKA_SOTO WHEN WK23.SYOKBN <> 0 THEN WK23.B_BAIKA_SOTO WHEN WK24.MSF = 'B' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.B_SOBAIFG THEN SHN.RG_BAIKAAM ELSE WK24.B_SOBAIFG END ELSE WK23.B_BAIKA_SOTO END AS B_BAIKA_SOTO, CASE WHEN WK23.C_BAIKA_SOTO = 0 THEN WK23.C_BAIKA_SOTO WHEN WK24.MISE IS NULL THEN WK23.C_BAIKA_SOTO WHEN WK23.SYOKBN <> 0 THEN WK23.C_BAIKA_SOTO WHEN WK24.MSF = 'C' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.C_SOBAIFG THEN SHN.RG_BAIKAAM ELSE WK24.C_SOBAIFG END ELSE WK23.C_BAIKA_SOTO END AS C_BAIKA_SOTO, WK23.HEKINP, CASE WHEN WK23.MISIR = 0 THEN WK23.MISIR WHEN WK24.MISE IS NULL THEN WK23.MISIR WHEN WK23.SYOKBN <> 0 THEN WK23.MISIR WHEN WK24.MSF = 'A' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.A_SOBAIFG THEN SHN.RG_IRISU ELSE WK24.MISIR END WHEN WK24.MSF = 'B' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.B_SOBAIFG THEN SHN.RG_IRISU ELSE WK24.MISIR END WHEN WK24.MSF = 'C' THEN CASE WHEN SHN.RG_BAIKAAM < WK24.C_SOBAIFG THEN SHN.RG_IRISU ELSE WK24.MISIR END ELSE WK23.MISIR END AS MISIR, WK23.BD1SU, WK23.BD2SU, WK23.A_BDBAIKA, WK23.A_BD1BAIKA, WK23.A_BD2BAIKA, WK23.B_BDBAIKA, WK23.B_BD1BAIKA, WK23.B_BD2BAIKA, WK23.C_BDBAIKA, WK23.C_BD1BAIKA, WK23.C_BD2BAIKA, WK23.SIIRCD, WK23.NENMAT, WK23.TEISEK, WK23.TRTEISEK, WK23.TTKBN, WK23.KZKBN, WK23.TEFTEI, WK23.BETUDEN, WK23.WAPENK, WK23.IKKATK, WK23.JIZNUT, WK23.SIDENF, WK23.TEICUTK, WK23.HOUZAI, WK23.DSEIK, WK23.PCKBN, WK23.HIGAWAK, WK23.HGEBATFL, WK23.REDMYFL, WK23.DATAK, WK23.SEISUR, WK23.HENSUR, WK23.SEITK, WK23.NONSJ, WK23.ATARA, WK23.RDHMHYO, WK23.RDHMMON, WK23.RDHMTUE, WK23.RDHMWED, WK23.RDHMTHU, WK23.RDHMFRI, WK23.RDHMSAT, WK23.RDHMSUN, WK23.NONSU, WK23.BUNBMC1, WK23.BUNDIC, WK23.BUNCHC, WK23.BUNSHC, WK23.BUNSSC, WK23.MSSIRE, WK23.MSIR, WK23.MSIKK, WK23.MSWAP, WK23.MSBIN, WK23.MOYOK, WK23.MOYOKA, WK23.MOYORE, WK23.BUNBMC2, WK23.KANBAN, WK23.EDABAN, WK23.SHUNO, WK23.SMISECD, WK23.KZCUT, WK23.KOUCUT, WK23.TEICUT, WK23.TOKCUT, WK23.KYUCUT, WK23.HACCUT, WK23.NONCUT, WK23.HSSCUT, WK23.ZERO, WK23.FILLER02, WK23.SYORIK, WK23.TOKCOME, WK23.KIKMKJ, WK23.SANTIMKJ, WK23.JIZNB, WK23.JZHCB, WK23.JZHCSUB, WK23.SIHCSYB, WK23.TTENRANK, WK23.HCUSU, WK23.BAISNKB, WK23.KZKUBETU, WK23.SYUFLG, WK23.HYSYUFLG, WK23.JZNLSKSKB, WK23.ANKUMUKB, WK23.FILLER03, WK23.SAKSEIB FROM INAWK.D2WK23_ZZQ102_Z WK23 LEFT OUTER JOIN (SELECT * FROM INAPRE.MSTSHN_PD SHN2 WHERE SHN2.UPDKBN <> 1 AND EXISTS (SELECT 1 FROM INAWK.D2WK24_ZZQ112 T2 WHERE T2.SHOCD = SHN2.SHNCD)) SHN ON WK23.SHOHNC = SHN.SHNCD LEFT OUTER JOIN (SELECT * FROM (SELECT T1.*, ROW_NUMBER() OVER (PARTITION BY T1.SHOCD, T1.MISE, T1.NNYNOB ORDER BY T1.BAIKA, T1.MOYOK DESC, T1.MOYOKA DESC, T1.MOYORE DESC, T1.BUNBMC, T1.KANBAN) AS ODRNO FROM INAWK.D2WK24_ZZQ112 T1 WHERE EXISTS (SELECT 1 FROM INAPRE.MSTSHN_PD SHN1 WHERE SHN1.UPDKBN <> 1 AND T1.SHOCD = SHN1.SHNCD)) MS WHERE ODRNO = 1) WK24 ON WK24.MISE = WK23.MISE AND WK24.SHOCD = WK23.SHOHNC AND WK24.NNYNOB = WK23.NNYNOB) SELECT WK28.REC_HAN_KBN, WK28.MISE, WK28.SHOHNC, WK28.FILLER01, WK28.SYOKBN, WK28.BINK, WK28.NOKAIS, WK28.NOSYUR, WK28.HAKAIS, WK28.HASYUR, WK28.NNYNOB, WK28.NONYB, CASE WHEN WK27.MISE IS NULL THEN WK28.HACHBI WHEN WK28.HACHBI <> WK27.HACHBI THEN WK27.HACHBI ELSE WK28.HACHBI END AS HACHBI, CASE WHEN WK27.MISE IS NULL THEN WK28.HACYB WHEN WK28.HACHBI <> WK27.HACHBI THEN WK27.HACYB ELSE WK28.HACYB END AS HACYB, WK28.JZNGENKA, WK28.TUIGENKA, WK28.GENFU, WK28.GENFUK, WK28.A_SOBAIFG, WK28.B_SOBAIFG, WK28.C_SOBAIFG, WK28.A_SOBAIFP, WK28.B_SOBAIFP, WK28.C_SOBAIFP, WK28.A_SOBAIFK, WK28.B_SOBAIFK, WK28.C_SOBAIFK, WK28.A_BAIKA_SOTO, WK28.B_BAIKA_SOTO, WK28.C_BAIKA_SOTO, WK28.HEKINP, WK28.MISIR, WK28.BD1SU, WK28.BD2SU, WK28.A_BDBAIKA, WK28.A_BD1BAIKA, WK28.A_BD2BAIKA, WK28.B_BDBAIKA, WK28.B_BD1BAIKA, WK28.B_BD2BAIKA, WK28.C_BDBAIKA, WK28.C_BD1BAIKA, WK28.C_BD2BAIKA, WK28.SIIRCD, WK28.NENMAT, WK28.TEISEK, WK28.TRTEISEK, WK28.TTKBN, WK28.KZKBN, WK28.TEFTEI, WK28.BETUDEN, WK28.WAPENK, WK28.IKKATK, WK28.JIZNUT, WK28.SIDENF, WK28.TEICUTK, WK28.HOUZAI, WK28.DSEIK, WK28.PCKBN, WK28.HIGAWAK, WK28.HGEBATFL, WK28.REDMYFL, WK28.DATAK, WK28.SEISUR, WK28.HENSUR, WK28.SEITK, WK28.NONSJ, WK28.ATARA, WK28.RDHMHYO, WK28.RDHMMON, WK28.RDHMTUE, WK28.RDHMWED, WK28.RDHMTHU, WK28.RDHMFRI, WK28.RDHMSAT, WK28.RDHMSUN, WK28.NONSU, WK28.BUNBMC1, WK28.BUNDIC, WK28.BUNCHC, WK28.BUNSHC, WK28.BUNSSC, WK28.MSSIRE, WK28.MSIR, WK28.MSIKK, WK28.MSWAP, WK28.MSBIN, WK28.MOYOK, WK28.MOYOKA, WK28.MOYORE, WK28.BUNBMC2, WK28.KANBAN, WK28.EDABAN, WK28.SHUNO, WK28.SMISECD, WK28.KZCUT, WK28.KOUCUT, WK28.TEICUT, WK28.TOKCUT, WK28.KYUCUT, WK28.HACCUT, WK28.NONCUT, WK28.HSSCUT, WK28.ZERO, WK28.FILLER02, WK28.SYORIK, WK28.TOKCOME, WK28.KIKMKJ, WK28.SANTIMKJ, WK28.JIZNB, WK28.JZHCB, WK28.JZHCSUB, WK28.SIHCSYB, WK28.TTENRANK, WK28.HCUSU, WK28.BAISNKB, WK28.KZKUBETU, WK28.SYUFLG, WK28.HYSYUFLG, WK28.JZNLSKSKB, WK28.ANKUMUKB, WK28.FILLER03, WK28.SAKSEIB FROM WK28 LEFT OUTER JOIN INAWK.D2WK27_ZZQ102_Z WK27 ON WK28.MISE = WK27.MISE AND WK28.SHOHNC = WK27.SHOHNC AND WK28.FILLER01 = WK27.FILLER01 AND WK28.SYOKBN = WK27.SYOKBN AND WK28.BINK = WK27.BINK AND WK28.NOKAIS = WK27.NOKAIS AND WK28.NOSYUR = WK27.NOSYUR AND WK28.HAKAIS = WK27.HAKAIS AND WK28.HASYUR = WK27.HASYUR AND WK28.NNYNOB = WK27.NNYNOB AND WK28.MOYOK = WK27.MOYOK AND WK28.MOYOKA = WK27.MOYOKA AND WK28.MOYORE = WK27.MOYORE AND WK28.BUNBMC2 = WK27.BUNBMC2 AND WK28.KANBAN = WK27.KANBAN AND WK28.EDABAN = WK27.EDABAN AND WK28.HCUSU = WK27.HCUSU;
COMMIT;
