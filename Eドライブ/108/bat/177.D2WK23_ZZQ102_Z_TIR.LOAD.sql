SET SESSION aurora_parallel_query = ON;
INSERT IGNORE INTO INAWK.D2WK23_ZZQ102_Z_TIR SELECT TIR.REC_HAN_KBN, TIR.MISE, TIR.SHOHNC, TIR.FILLER01, TIR.SYOKBN, TIR.BINK, TIR.NOKAIS, TIR.NOSYUR, TIR.HAKAIS, TIR.HASYUR, TIR.NNYNOB, TIR.NONYB, TIR.HACHBI, TIR.HACYB, TIR.JZNGENKA, TIR.TUIGENKA, TIR.GENFU, TIR.GENFUK, TIR.A_SOBAIFG, TIR.B_SOBAIFG, TIR.C_SOBAIFG, TIR.A_SOBAIFP, TIR.B_SOBAIFP, TIR.C_SOBAIFP, TIR.A_SOBAIFK, TIR.B_SOBAIFK, TIR.C_SOBAIFK, TIR.A_BAIKA_SOTO, TIR.B_BAIKA_SOTO, TIR.C_BAIKA_SOTO, TIR.HEKINP, TIR.MISIR, TIR.BD1SU, TIR.BD2SU, TIR.A_BDBAIKA, TIR.A_BD1BAIKA, TIR.A_BD2BAIKA, TIR.B_BDBAIKA, TIR.B_BD1BAIKA, TIR.B_BD2BAIKA, TIR.C_BDBAIKA, TIR.C_BD1BAIKA, TIR.C_BD2BAIKA, TIR.SIIRCD, TIR.NENMAT, TIR.TEISEK, TIR.TRTEISEK, TIR.TTKBN, TIR.KZKBN, TIR.TEFTEI, TIR.BETUDEN, TIR.WAPENK, TIR.IKKATK, TIR.JIZNUT, TIR.SIDENF, TIR.TEICUTK, TIR.HOUZAI, TIR.DSEIK, TIR.PCKBN, TIR.HIGAWAK, TIR.HGEBATFL, TIR.REDMYFL, TIR.DATAK, TIR.SEISUR, TIR.HENSUR, TIR.SEITK, TIR.NONSJ, TIR.ATARA, TIR.RDHMHYO, TIR.RDHMMON, TIR.RDHMTUE, TIR.RDHMWED, TIR.RDHMTHU, TIR.RDHMFRI, TIR.RDHMSAT, TIR.RDHMSUN, TIR.NONSU, TIR.BUNBMC1, TIR.BUNDIC, TIR.BUNCHC, TIR.BUNSHC, TIR.BUNSSC, TIR.MSSIRE, TIR.MSIR, TIR.MSIKK, TIR.MSWAP, TIR.MSBIN, TIR.MOYOK, TIR.MOYOKA, TIR.MOYORE, TIR.BUNBMC2, TIR.KANBAN, TIR.EDABAN, TIR.SHUNO, TIR.SMISECD, TIR.KZCUT, TIR.KOUCUT, TIR.TEICUT, TIR.TOKCUT, TIR.KYUCUT, TIR.HACCUT, TIR.NONCUT, TIR.HSSCUT, TIR.ZERO, TIR.FILLER02, TIR.SYORIK, TIR.TOKCOME, TIR.KIKMKJ, TIR.SANTIMKJ, TIR.JIZNB, TIR.JZHCB, TIR.JZHCSUB, TIR.SIHCSYB, TIR.TTENRANK, TIR.HCUSU, TIR.BAISNKB, TIR.KZKUBETU, TIR.SYUFLG, TIR.HYSYUFLG, TIR.JZNLSKSKB, TIR.ANKUMUKB, TIR.FILLER03, TIR.SAKSEIB, TIR.DWFLG, TIR.DWFLG2, TIR.NNYNOB AS NNYNOB00, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 1 DAY), '%Y%m%d') END AS NNYNOB01, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 2 DAY), '%Y%m%d') END AS NNYNOB02, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 3 DAY), '%Y%m%d') END AS NNYNOB03, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 4 DAY), '%Y%m%d') END AS NNYNOB04, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 5 DAY), '%Y%m%d') END AS NNYNOB05, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 6 DAY), '%Y%m%d') END AS NNYNOB06, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 7 DAY), '%Y%m%d') END AS NNYNOB07, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 8 DAY), '%Y%m%d') END AS NNYNOB08, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 9 DAY), '%Y%m%d') END AS NNYNOB09, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 10 DAY), '%Y%m%d') END AS NNYNOB10, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 11 DAY), '%Y%m%d') END AS NNYNOB11, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 0 DAY)) + 1 END AS NNYNOWEK00, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 1 DAY)) + 1 END AS NNYNOWEK01, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 2 DAY)) + 1 END AS NNYNOWEK02, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 3 DAY)) + 1 END AS NNYNOWEK03, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 4 DAY)) + 1 END AS NNYNOWEK04, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 5 DAY)) + 1 END AS NNYNOWEK05, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 6 DAY)) + 1 END AS NNYNOWEK06, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 7 DAY)) + 1 END AS NNYNOWEK07, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 8 DAY)) + 1 END AS NNYNOWEK08, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 9 DAY)) + 1 END AS NNYNOWEK09, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 10 DAY)) + 1 END AS NNYNOWEK10, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 11 DAY)) + 1 END AS NNYNOWEK11, CASE WHEN TIR.JIZNUT = 2 THEN TIR.JIZNB ELSE TIR.HACHBI END AS SETHACHBI, CASE WHEN TIR.JIZNUT = 2 THEN CASE WHEN COALESCE(TIR.JIZNB, 0) = 0 THEN 0 ELSE WEEKDAY(DATE_FORMAT(TIR.JIZNB, '%Y%m%d')) + 1 END ELSE TIR.HACYB END AS SETHACYB FROM INAWK.D2WK21_ZZQ102 TIR;
INSERT IGNORE INTO INAWK.D2WK23_ZZQ102_Z_TIR SELECT TIR.REC_HAN_KBN, TIR.MISE, TIR.SHOHNC, TIR.FILLER01, TIR.SYOKBN, TIR.BINK, TIR.NOKAIS, TIR.NOSYUR, TIR.HAKAIS, TIR.HASYUR, TIR.NNYNOB, TIR.NONYB, TIR.HACHBI, TIR.HACYB, TIR.JZNGENKA, TIR.TUIGENKA, TIR.GENFU, TIR.GENFUK, TIR.A_SOBAIFG, TIR.B_SOBAIFG, TIR.C_SOBAIFG, TIR.A_SOBAIFP, TIR.B_SOBAIFP, TIR.C_SOBAIFP, TIR.A_SOBAIFK, TIR.B_SOBAIFK, TIR.C_SOBAIFK, TIR.A_BAIKA_SOTO, TIR.B_BAIKA_SOTO, TIR.C_BAIKA_SOTO, TIR.HEKINP, TIR.MISIR, TIR.BD1SU, TIR.BD2SU, TIR.A_BDBAIKA, TIR.A_BD1BAIKA, TIR.A_BD2BAIKA, TIR.B_BDBAIKA, TIR.B_BD1BAIKA, TIR.B_BD2BAIKA, TIR.C_BDBAIKA, TIR.C_BD1BAIKA, TIR.C_BD2BAIKA, TIR.SIIRCD, TIR.NENMAT, TIR.TEISEK, TIR.TRTEISEK, TIR.TTKBN, TIR.KZKBN, TIR.TEFTEI, TIR.BETUDEN, TIR.WAPENK, TIR.IKKATK, TIR.JIZNUT, TIR.SIDENF, TIR.TEICUTK, TIR.HOUZAI, TIR.DSEIK, TIR.PCKBN, TIR.HIGAWAK, TIR.HGEBATFL, TIR.REDMYFL, TIR.DATAK, TIR.SEISUR, TIR.HENSUR, TIR.SEITK, TIR.NONSJ, TIR.ATARA, TIR.RDHMHYO, TIR.RDHMMON, TIR.RDHMTUE, TIR.RDHMWED, TIR.RDHMTHU, TIR.RDHMFRI, TIR.RDHMSAT, TIR.RDHMSUN, TIR.NONSU, TIR.BUNBMC1, TIR.BUNDIC, TIR.BUNCHC, TIR.BUNSHC, TIR.BUNSSC, TIR.MSSIRE, TIR.MSIR, TIR.MSIKK, TIR.MSWAP, TIR.MSBIN, TIR.MOYOK, TIR.MOYOKA, TIR.MOYORE, TIR.BUNBMC2, TIR.KANBAN, TIR.EDABAN, TIR.SHUNO, TIR.SMISECD, TIR.KZCUT, TIR.KOUCUT, TIR.TEICUT, TIR.TOKCUT, TIR.KYUCUT, TIR.HACCUT, TIR.NONCUT, TIR.HSSCUT, TIR.ZERO, TIR.FILLER02, TIR.SYORIK, TIR.TOKCOME, TIR.KIKMKJ, TIR.SANTIMKJ, TIR.JIZNB, TIR.JZHCB, TIR.JZHCSUB, TIR.SIHCSYB, TIR.TTENRANK, TIR.HCUSU, TIR.BAISNKB, TIR.KZKUBETU, TIR.SYUFLG, TIR.HYSYUFLG, TIR.JZNLSKSKB, TIR.ANKUMUKB, TIR.FILLER03, TIR.SAKSEIB, TIR.DWFLG, TIR.DWFLG2, TIR.NNYNOB AS NNYNOB00, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 1 DAY), '%Y%m%d') END AS NNYNOB01, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 2 DAY), '%Y%m%d') END AS NNYNOB02, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 3 DAY), '%Y%m%d') END AS NNYNOB03, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 4 DAY), '%Y%m%d') END AS NNYNOB04, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 5 DAY), '%Y%m%d') END AS NNYNOB05, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 6 DAY), '%Y%m%d') END AS NNYNOB06, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 7 DAY), '%Y%m%d') END AS NNYNOB07, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 8 DAY), '%Y%m%d') END AS NNYNOB08, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 9 DAY), '%Y%m%d') END AS NNYNOB09, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 10 DAY), '%Y%m%d') END AS NNYNOB10, CASE WHEN TIR.NNYNOB = 0 THEN TIR.NNYNOB ELSE DATE_FORMAT(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 11 DAY), '%Y%m%d') END AS NNYNOB11, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 0 DAY)) + 1 END AS NNYNOWEK00, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 1 DAY)) + 1 END AS NNYNOWEK01, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 2 DAY)) + 1 END AS NNYNOWEK02, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 3 DAY)) + 1 END AS NNYNOWEK03, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 4 DAY)) + 1 END AS NNYNOWEK04, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 5 DAY)) + 1 END AS NNYNOWEK05, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 6 DAY)) + 1 END AS NNYNOWEK06, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 7 DAY)) + 1 END AS NNYNOWEK07, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 8 DAY)) + 1 END AS NNYNOWEK08, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 9 DAY)) + 1 END AS NNYNOWEK09, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 10 DAY)) + 1 END AS NNYNOWEK10, CASE WHEN TIR.NNYNOB = 0 THEN 0 ELSE WEEKDAY(DATE_ADD(DATE_FORMAT(TIR.NNYNOB, '%Y%m%d'), INTERVAL - 11 DAY)) + 1 END AS NNYNOWEK11, CASE WHEN TIR.JIZNUT = 2 THEN TIR.JIZNB ELSE TIR.HACHBI END AS SETHACHBI, CASE WHEN TIR.JIZNUT = 2 THEN CASE WHEN COALESCE(TIR.JIZNB, 0) = 0 THEN 0 ELSE WEEKDAY(DATE_FORMAT(TIR.JIZNB, '%Y%m%d')) + 1 END ELSE TIR.HACYB END AS SETHACYB FROM INAWK.D2WK22_ZZQ102 TIR;
COMMIT;
