INSERT IGNORE INTO INAWK.D2WK20_ZZQ102 WITH KASAN AS (SELECT CAST(DATE_FORMAT(DATE_SUB(SBD.DT, INTERVAL PAT.GENNISU DAY), '%Y%m%d') AS SIGNED) AS SYORDT, CAST(DATE_FORMAT(DATE_ADD(SBD.DT, INTERVAL (PAT.ADDNISU - PAT.GENNISU) DAY), '%Y%m%d') AS SIGNED) AS SYORDT2, PAT.ADDNISU AS NISU FROM INAPARM.PRAM_ADDNISU_TENTEIRYOTKFILE PAT INNER JOIN INAPARM.SYSBATCHDT_TK SBD ON SBD.SMODE = 'DAILY' WHERE PAT.ADDNISUSMODE = 'ZENTEN13') SELECT WK20_1.REC_HAN_KBN, WK20_1.MISE, WK20_1.SHOHNC, WK20_1.FILLER01, WK20_1.SYOKBN, WK20_1.BINK, WK20_1.NOKAIS, WK20_1.NOSYUR, WK20_1.HAKAIS, WK20_1.HASYUR, WK20_1.NNYNOB, WK20_1.NONYB, WK20_1.HACHBI, WK20_1.HACYB, CASE WHEN WK20_1.JZNGENKA = 0 THEN WK20_1.JZNGENKA WHEN WK20_1.MOYOK = 0 THEN SHN.RG_GENKAAM WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_GENKAAM ELSE WK20_1.JZNGENKA END AS JZNGENKA, CASE WHEN WK20_1.TUIGENKA = 0 THEN WK20_1.TUIGENKA WHEN WK20_1.MOYOK = 0 THEN SHN.RG_GENKAAM WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_GENKAAM ELSE WK20_1.TUIGENKA END AS TUIGENKA, CASE WHEN WK20_1.GENFU = 0 THEN WK20_1.GENFU WHEN WK20_1.MOYOK = 0 THEN SHN.RG_GENKAAM WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_GENKAAM ELSE WK20_1.GENFU END AS GENFU, CASE WHEN WK20_1.GENFUK = 0 THEN WK20_1.GENFUK WHEN WK20_1.MOYOK = 0 THEN SHN.RG_GENKAAM WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_GENKAAM ELSE WK20_1.GENFUK END AS GENFUK, CASE WHEN WK20_1.A_SOBAIFG = 0 THEN WK20_1.A_SOBAIFG WHEN WK20_1.MOYOK = 0 THEN SHN.RG_BAIKAAM WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_BAIKAAM ELSE WK20_1.A_SOBAIFG END AS A_SOBAIFG, CASE WHEN WK20_1.B_SOBAIFG = 0 THEN WK20_1.B_SOBAIFG WHEN WK20_1.MOYOK = 0 THEN SHN.RG_BAIKAAM WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_BAIKAAM ELSE WK20_1.B_SOBAIFG END AS B_SOBAIFG, CASE WHEN WK20_1.C_SOBAIFG = 0 THEN WK20_1.C_SOBAIFG WHEN WK20_1.MOYOK = 0 THEN SHN.RG_BAIKAAM WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_BAIKAAM ELSE WK20_1.C_SOBAIFG END AS C_SOBAIFG, CASE WHEN WK20_1.A_SOBAIFP = 0 THEN WK20_1.A_SOBAIFP WHEN WK20_1.MOYOK = 0 THEN SHN.RG_BAIKAAM WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_BAIKAAM ELSE WK20_1.A_SOBAIFP END AS A_SOBAIFP, CASE WHEN WK20_1.B_SOBAIFP = 0 THEN WK20_1.B_SOBAIFP WHEN WK20_1.MOYOK = 0 THEN SHN.RG_BAIKAAM WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_BAIKAAM ELSE WK20_1.B_SOBAIFP END AS B_SOBAIFP, CASE WHEN WK20_1.C_SOBAIFP = 0 THEN WK20_1.C_SOBAIFP WHEN WK20_1.MOYOK = 0 THEN SHN.RG_BAIKAAM WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_BAIKAAM ELSE WK20_1.C_SOBAIFP END AS C_SOBAIFP, CASE WHEN WK20_1.A_SOBAIFK = 0 THEN WK20_1.A_SOBAIFK WHEN WK20_1.MOYOK = 0 THEN SHN.RG_BAIKAAM WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_BAIKAAM ELSE WK20_1.A_SOBAIFK END AS A_SOBAIFK, CASE WHEN WK20_1.B_SOBAIFK = 0 THEN WK20_1.B_SOBAIFK WHEN WK20_1.MOYOK = 0 THEN SHN.RG_BAIKAAM WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_BAIKAAM ELSE WK20_1.B_SOBAIFK END AS B_SOBAIFK, CASE WHEN WK20_1.C_SOBAIFK = 0 THEN WK20_1.C_SOBAIFK WHEN WK20_1.MOYOK = 0 THEN SHN.RG_BAIKAAM WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_BAIKAAM ELSE WK20_1.C_SOBAIFK END AS C_SOBAIFK, CASE WHEN WK20_1.A_BAIKA_SOTO = 0 THEN WK20_1.A_BAIKA_SOTO WHEN WK20_1.MOYOK = 0 THEN SHN.RG_BAIKAAM WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_BAIKAAM ELSE WK20_1.A_BAIKA_SOTO END AS A_BAIKA_SOTO, CASE WHEN WK20_1.B_BAIKA_SOTO = 0 THEN WK20_1.B_BAIKA_SOTO WHEN WK20_1.MOYOK = 0 THEN SHN.RG_BAIKAAM WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_BAIKAAM ELSE WK20_1.B_BAIKA_SOTO END AS B_BAIKA_SOTO, CASE WHEN WK20_1.C_BAIKA_SOTO = 0 THEN WK20_1.C_BAIKA_SOTO WHEN WK20_1.MOYOK = 0 THEN SHN.RG_BAIKAAM WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_BAIKAAM ELSE WK20_1.C_BAIKA_SOTO END AS C_BAIKA_SOTO, WK20_1.HEKINP, CASE WHEN WK20_1.MISIR = 0 THEN WK20_1.MISIR WHEN WK20_1.MOYOK = 0 THEN SHN.RG_IRISU WHEN WK20_1.SYOKBN = 0 AND WK20_1.MOYOK IN (8, 9) THEN SHN.RG_IRISU ELSE WK20_1.MISIR END AS MISIR, WK20_1.BD1SU, WK20_1.BD2SU, WK20_1.A_BDBAIKA, WK20_1.A_BD1BAIKA, WK20_1.A_BD2BAIKA, WK20_1.B_BDBAIKA, WK20_1.B_BD1BAIKA, WK20_1.B_BD2BAIKA, WK20_1.C_BDBAIKA, WK20_1.C_BD1BAIKA, WK20_1.C_BD2BAIKA, WK20_1.SIIRCD, WK20_1.NENMAT, WK20_1.TEISEK, WK20_1.TRTEISEK, WK20_1.TTKBN, WK20_1.KZKBN, WK20_1.TEFTEI, WK20_1.BETUDEN, WK20_1.WAPENK, WK20_1.IKKATK, WK20_1.JIZNUT, WK20_1.SIDENF, WK20_1.TEICUTK, WK20_1.HOUZAI, WK20_1.DSEIK, WK20_1.PCKBN, WK20_1.HIGAWAK, WK20_1.HGEBATFL, WK20_1.REDMYFL, WK20_1.DATAK, WK20_1.SEISUR, WK20_1.HENSUR, WK20_1.SEITK, WK20_1.NONSJ, WK20_1.ATARA, WK20_1.RDHMHYO, WK20_1.RDHMMON, WK20_1.RDHMTUE, WK20_1.RDHMWED, WK20_1.RDHMTHU, WK20_1.RDHMFRI, WK20_1.RDHMSAT, WK20_1.RDHMSUN, WK20_1.NONSU, WK20_1.BUNBMC1, WK20_1.BUNDIC, WK20_1.BUNCHC, WK20_1.BUNSHC, WK20_1.BUNSSC, WK20_1.MSSIRE, WK20_1.MSIR, WK20_1.MSIKK, WK20_1.MSWAP, WK20_1.MSBIN, WK20_1.MOYOK, WK20_1.MOYOKA, WK20_1.MOYORE, WK20_1.BUNBMC2, WK20_1.KANBAN, WK20_1.EDABAN, WK20_1.SHUNO, WK20_1.SMISECD, WK20_1.KZCUT, WK20_1.KOUCUT, WK20_1.TEICUT, WK20_1.TOKCUT, WK20_1.KYUCUT, WK20_1.HACCUT, WK20_1.NONCUT, WK20_1.HSSCUT, WK20_1.ZERO, WK20_1.FILLER02, WK20_1.SYORIK, WK20_1.TOKCOME, WK20_1.KIKMKJ, WK20_1.SANTIMKJ, WK20_1.JIZNB, WK20_1.JZHCB, WK20_1.JZHCSUB, WK20_1.SIHCSYB, WK20_1.TTENRANK, WK20_1.HCUSU, CASE WHEN TRIM(WK20_1.BAISNKB) = '' THEN '1' ELSE WK20_1.BAISNKB END AS BAISNKB, WK20_1.KZKUBETU, WK20_1.SYUFLG, WK20_1.HYSYUFLG, WK20_1.JZNLSKSKB, WK20_1.ANKUMUKB, WK20_1.FILLER03, WK20_1.SAKSEIB, CASE WHEN SHN.SHNCD IS NULL THEN 'W' WHEN WK20_1.NNYNOB <= CAST(DATE_FORMAT(DATE_ADD(SBD.DTTIME, INTERVAL CASE WHEN SBD.YOBI = 1 THEN PRRTM2.READTM_MON WHEN SBD.YOBI = 2 THEN PRRTM2.READTM_TUE WHEN SBD.YOBI = 3 THEN PRRTM2.READTM_WED WHEN SBD.YOBI = 4 THEN PRRTM2.READTM_THU WHEN SBD.YOBI = 5 THEN PRRTM2.READTM_FRI WHEN SBD.YOBI = 6 THEN PRRTM2.READTM_SAT WHEN SBD.YOBI = 7 THEN PRRTM2.READTM_SUN END DAY), '%Y%m%d') AS SIGNED) THEN 'D' ELSE 'W' END AS FLG1, CASE WHEN WK20_1.MOYOK = 3 THEN 3 WHEN WK20_1.MOYOK = 1 AND WK20_1.MOYORE >= 50 THEN 1 ELSE 49 END AS FLG2 FROM (SELECT 0 AS REC_HAN_KBN, TEN.TENCD AS MISE, TEIRZ.SHOHNC, TEIRZ.FILLER01, TEIRZ.SYOKBN, TEIRZ.BINK, TEIRZ.NOKAIS, TEIRZ.NOSYUR, TEIRZ.HAKAIS, TEIRZ.HASYUR, TEIRZ.NNYNOB, TEIRZ.NONYB, TEIRZ.HACHBI, TEIRZ.HACYB, TEIRZ.JZNGENKA, TEIRZ.TUIGENKA, TEIRZ.GENFU, TEIRZ.GENFUK, CASE WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.A_SOBAIFG, 0) * 100 / (100 + COALESCE(MZS1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.A_SOBAIFG, 0) * 100 / (100 + COALESCE(MZS2.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.A_SOBAIFG, 0) * 100 / (100 + COALESCE(MZB1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.A_SOBAIFG, 0) * 100 / (100 + COALESCE(MZB2.ZEIRT, 0))), 0) ELSE TEIRZ.A_SOBAIFG END AS A_SOBAIFG, CASE WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.B_SOBAIFG, 0) * 100 / (100 + COALESCE(MZS1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.B_SOBAIFG, 0) * 100 / (100 + COALESCE(MZS2.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.B_SOBAIFG, 0) * 100 / (100 + COALESCE(MZB1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.B_SOBAIFG, 0) * 100 / (100 + COALESCE(MZB2.ZEIRT, 0))), 0) ELSE TEIRZ.B_SOBAIFG END AS B_SOBAIFG, CASE WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.C_SOBAIFG, 0) * 100 / (100 + COALESCE(MZS1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.C_SOBAIFG, 0) * 100 / (100 + COALESCE(MZS2.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.C_SOBAIFG, 0) * 100 / (100 + COALESCE(MZB1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.C_SOBAIFG, 0) * 100 / (100 + COALESCE(MZB2.ZEIRT, 0))), 0) ELSE TEIRZ.C_SOBAIFG END AS C_SOBAIFG, CASE WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.A_SOBAIFP, 0) * 100 / (100 + COALESCE(MZS1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.A_SOBAIFP, 0) * 100 / (100 + COALESCE(MZS2.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.A_SOBAIFP, 0) * 100 / (100 + COALESCE(MZB1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.A_SOBAIFP, 0) * 100 / (100 + COALESCE(MZB2.ZEIRT, 0))), 0) ELSE TEIRZ.A_SOBAIFP END AS A_SOBAIFP, CASE WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.B_SOBAIFP, 0) * 100 / (100 + COALESCE(MZS1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.B_SOBAIFP, 0) * 100 / (100 + COALESCE(MZS2.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.B_SOBAIFP, 0) * 100 / (100 + COALESCE(MZB1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.B_SOBAIFP, 0) * 100 / (100 + COALESCE(MZB2.ZEIRT, 0))), 0) ELSE TEIRZ.B_SOBAIFP END AS B_SOBAIFP, CASE WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.C_SOBAIFP, 0) * 100 / (100 + COALESCE(MZS1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.C_SOBAIFP, 0) * 100 / (100 + COALESCE(MZS2.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.C_SOBAIFP, 0) * 100 / (100 + COALESCE(MZB1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.C_SOBAIFP, 0) * 100 / (100 + COALESCE(MZB2.ZEIRT, 0))), 0) ELSE TEIRZ.C_SOBAIFP END AS C_SOBAIFP, CASE WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.A_SOBAIFK, 0) * 100 / (100 + COALESCE(MZS1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.A_SOBAIFK, 0) * 100 / (100 + COALESCE(MZS2.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.A_SOBAIFK, 0) * 100 / (100 + COALESCE(MZB1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.A_SOBAIFK, 0) * 100 / (100 + COALESCE(MZB2.ZEIRT, 0))), 0) ELSE TEIRZ.A_SOBAIFK END AS A_SOBAIFK, CASE WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.B_SOBAIFK, 0) * 100 / (100 + COALESCE(MZS1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.B_SOBAIFK, 0) * 100 / (100 + COALESCE(MZS2.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.B_SOBAIFK, 0) * 100 / (100 + COALESCE(MZB1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.B_SOBAIFK, 0) * 100 / (100 + COALESCE(MZB2.ZEIRT, 0))), 0) ELSE TEIRZ.B_SOBAIFK END AS B_SOBAIFK, CASE WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.C_SOBAIFK, 0) * 100 / (100 + COALESCE(MZS1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.C_SOBAIFK, 0) * 100 / (100 + COALESCE(MZS2.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.C_SOBAIFK, 0) * 100 / (100 + COALESCE(MZB1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.C_SOBAIFK, 0) * 100 / (100 + COALESCE(MZB2.ZEIRT, 0))), 0) ELSE TEIRZ.C_SOBAIFK END AS C_SOBAIFK, CASE WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.A_BAIKA_SOTO, 0) * 100 / (100 + COALESCE(MZS1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.A_BAIKA_SOTO, 0) * 100 / (100 + COALESCE(MZS2.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.A_BAIKA_SOTO, 0) * 100 / (100 + COALESCE(MZB1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.A_BAIKA_SOTO, 0) * 100 / (100 + COALESCE(MZB2.ZEIRT, 0))), 0) ELSE TEIRZ.A_BAIKA_SOTO END AS A_BAIKA_SOTO, CASE WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.B_BAIKA_SOTO, 0) * 100 / (100 + COALESCE(MZS1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.B_BAIKA_SOTO, 0) * 100 / (100 + COALESCE(MZS2.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.B_BAIKA_SOTO, 0) * 100 / (100 + COALESCE(MZB1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.B_BAIKA_SOTO, 0) * 100 / (100 + COALESCE(MZB2.ZEIRT, 0))), 0) ELSE TEIRZ.B_BAIKA_SOTO END AS B_BAIKA_SOTO, CASE WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.C_BAIKA_SOTO, 0) * 100 / (100 + COALESCE(MZS1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 0 AND COALESCE(MS.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.C_BAIKA_SOTO, 0) * 100 / (100 + COALESCE(MZS2.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) <= COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.C_BAIKA_SOTO, 0) * 100 / (100 + COALESCE(MZB1.ZEIRT, 0))), 0) WHEN MS.ZEIKBN = 3 AND MB.ZEIKBN = 0 AND COALESCE(MB.ZEIRTHENKODT, 0) > COALESCE(20000000 + TEIRZ.MOYOKA, 0) THEN COALESCE(CEIL(COALESCE(TEIRZ.C_BAIKA_SOTO, 0) * 100 / (100 + COALESCE(MZB2.ZEIRT, 0))), 0) ELSE TEIRZ.C_BAIKA_SOTO END AS C_BAIKA_SOTO, TEIRZ.HEKINP, TEIRZ.MISIR, TEIRZ.BD1SU, TEIRZ.BD2SU, TEIRZ.A_BDBAIKA, TEIRZ.A_BD1BAIKA, TEIRZ.A_BD2BAIKA, TEIRZ.B_BDBAIKA, TEIRZ.B_BD1BAIKA, TEIRZ.B_BD2BAIKA, TEIRZ.C_BDBAIKA, TEIRZ.C_BD1BAIKA, TEIRZ.C_BD2BAIKA, TEIRZ.SIIRCD, TEIRZ.NENMAT, CASE WHEN TEIRZ.TEISEK = '4' THEN '3' WHEN TEIRZ.TEISEK = '3' THEN '2' WHEN TEIRZ.TEISEK = '2' THEN '4' ELSE TEIRZ.TEISEK END AS TEISEK, CASE WHEN TEIRZ.TRTEISEK = 4 THEN 3 WHEN TEIRZ.TRTEISEK = 3 THEN 2 WHEN TEIRZ.TRTEISEK = 2 THEN 4 ELSE TEIRZ.TRTEISEK END AS TRTEISEK, TEIRZ.TTKBN, TEIRZ.KZKBN, CASE WHEN TEIRZ.TEFTEI = 1 THEN TEIRZ.TEFTEI ELSE 0 END AS TEFTEI, TEIRZ.BETUDEN, CASE WHEN TEIRZ.WAPENK = '0' THEN ' ' ELSE TEIRZ.WAPENK END AS WAPENK, TEIRZ.IKKATK, TEIRZ.JIZNUT, TEIRZ.SIDENF, TEIRZ.TEICUTK, TEIRZ.HOUZAI, TEIRZ.DSEIK, TEIRZ.PCKBN, TEIRZ.HIGAWAK, TEIRZ.HGEBATFL, TEIRZ.REDMYFL, TEIRZ.DATAK, TEIRZ.SEISUR, TEIRZ.HENSUR, CASE WHEN TEIRZ.SEITK = 4 THEN 3 WHEN TEIRZ.SEITK = 3 THEN 2 WHEN TEIRZ.SEITK = 2 THEN 4 ELSE TEIRZ.SEITK END AS SEITK, TEIRZ.NONSJ, TEIRZ.ATARA, TEIRZ.RDHMHYO, TEIRZ.RDHMMON, TEIRZ.RDHMTUE, TEIRZ.RDHMWED, TEIRZ.RDHMTHU, TEIRZ.RDHMFRI, TEIRZ.RDHMSAT, TEIRZ.RDHMSUN, TEIRZ.NONSU, TEIRZ.BUNBMC1, TEIRZ.BUNDIC, TEIRZ.BUNCHC, TEIRZ.BUNSHC, TEIRZ.BUNSSC, TEIRZ.MSSIRE, TEIRZ.MSIR, TEIRZ.MSIKK, TEIRZ.MSWAP, TEIRZ.MSBIN, TEIRZ.MOYOK, TEIRZ.MOYOKA, TEIRZ.MOYORE, TEIRZ.BUNBMC2, TEIRZ.KANBAN, TEIRZ.EDABAN, TEIRZ.SHUNO, TEIRZ.SMISECD, TEIRZ.KZCUT, TEIRZ.KOUCUT, TEIRZ.TEICUT, TEIRZ.TOKCUT, TEIRZ.KYUCUT, TEIRZ.HACCUT, TEIRZ.NONCUT, TEIRZ.HSSCUT, TEIRZ.ZERO, TEIRZ.FILLER02, TEIRZ.SYORIK, TEIRZ.TOKCOME, TEIRZ.KIKMKJ, TEIRZ.SANTIMKJ, TEIRZ.JIZNB, TEIRZ.JZHCB, TEIRZ.JZHCSUB, TEIRZ.SIHCSYB, TEIRZ.TTENRANK, CAST(SUBSTR(TEIRZ.MSF_TBL, ((TEN.TENCD - 1) * 7) + 1, 6) AS SIGNED) AS HCUSU, SUBSTR(TEIRZ.MSF_TBL, ((TEN.TENCD - 1) * 7) + 7, 1) AS BAISNKB, TEIRZ.KZKUBETU, TEIRZ.SYUFLG, TEIRZ.HYSYUFLG, TEIRZ.JZNLSKSKB, TEIRZ.ANKUMUKB, TEIRZ.FILLER03, TEIRZ.SAKSEIB FROM INAWK.BFB01_Z TEIRZ INNER JOIN KASAN ON (TEIRZ.NOKAIS <= KASAN.SYORDT2 AND TEIRZ.NOSYUR >= KASAN.SYORDT AND TEIRZ.NNYNOB >= KASAN.SYORDT) INNER JOIN (SELECT SEQ AS TENCD FROM INAPARM.MSTNUMS WHERE SEQ BETWEEN 1 AND 400) TEN ON 1 = 1 LEFT OUTER JOIN INAPRE.MSTSHN_PD MS ON TEIRZ.SHOHNC = MS.SHNCD AND MS.UPDKBN <> 1 LEFT OUTER JOIN INAMS2K.MSTBMN MB ON TEIRZ.BUNBMC2 = MB.BMNCD AND MB.UPDKBN <> 1 LEFT OUTER JOIN INAMS2K.MSTZEIRT MZS1 ON MZS1.ZEIRTKBN = MS.ZEIRTKBN AND MZS1.UPDKBN <> 1 LEFT OUTER JOIN INAMS2K.MSTZEIRT MZS2 ON MZS2.ZEIRTKBN = MS.ZEIRTKBN_OLD AND MZS2.UPDKBN <> 1 LEFT OUTER JOIN INAMS2K.MSTZEIRT MZB1 ON MZB1.ZEIRTKBN = MB.ZEIRTKBN AND MZB1.UPDKBN <> 1 LEFT OUTER JOIN INAMS2K.MSTZEIRT MZB2 ON MZB2.ZEIRTKBN = MB.ZEIRTKBN_OLD AND MZB2.UPDKBN <> 1 WHERE SUBSTR(TEIRZ.MSF_TBL, ((TEN.TENCD - 1) * 7) + 1, 6) <> 999999) WK20_1 INNER JOIN INAPARM.SYSBATCHDT_HA SBD ON SBD.SMODE = 'DAILY' LEFT OUTER JOIN INAPRE.MSTSHN_PD SHN ON WK20_1.SHOHNC = SHN.SHNCD AND SHN.UPDKBN <> 1 LEFT OUTER JOIN INAMS2K.MSTTENBMN TBMN ON WK20_1.MISE = TBMN.TENCD AND WK20_1.BUNBMC1 = TBMN.BMNCD AND TBMN.UPDKBN <> 1 LEFT OUTER JOIN INAWK.D2WK_PRAM_READTMCNV PRRTC2 ON SBD.DT_INT = PRRTC2.NNYNOB AND LEFT (SHN.SHNCD, 2) = PRRTC2.BMNCD AND CASE WHEN SHN.READTMPTN = 0 AND TBMN.TENCD IS NOT NULL THEN TBMN.READTMPTN ELSE SHN.READTMPTN END = PRRTC2.READTMPTN_BE LEFT OUTER JOIN INAWK.D2WK_PRAM_READTM PRRTM2 ON SBD.DT_INT = PRRTM2.NNYNOB AND CASE WHEN PRRTC2.BMNCD IS NOT NULL THEN PRRTC2.READTMPTN_AF WHEN SHN.READTMPTN = 0 AND TBMN.TENCD IS NOT NULL THEN TBMN.READTMPTN ELSE SHN.READTMPTN END = PRRTM2.READTMPTN;
commit;

