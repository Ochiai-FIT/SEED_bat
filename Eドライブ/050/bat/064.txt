--690486/690486
--A11#DP10 2P A11H470
SELECT MOYSCD,BMNCD,KANRINO,KANRIENO,SHNCD,TENCD FROM INAIF.AN_HANBAI_AFT
WHERE UPDKBN=0 AND
( (GTSIMECHGKBN=1 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=2 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=3 AND GTSIMEOKFLG=0)
OR(GTSIMECHGKBN=4 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=0 AND GTSIMEOKFLG=0)
)
;
--17179/17179
--A11#DP10 2P A11H480
SELECT MOYSCD,BMNCD,KANRINO,KANRIENO,SHNCD,TENCD FROM INAIF.AN_NOUNYU_AFT
WHERE UPDKBN IN(0,8) AND
( (GTSIMECHGKBN=1 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=2 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=3 AND GTSIMEOKFLG=0)
OR(GTSIMECHGKBN=4 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=0 AND GTSIMEOKFLG=0)
)
;
--A11#DP10 2P A11H490
SELECT * FROM (
SELECT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,KANRIENO,SHNCD,TENCD FROM INAIF.AN_HANBAI_AFT
WHERE UPDKBN=0 AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
UNION
SELECT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,KANRIENO,SHNCD,TENCD FROM INAIF.AN_NOUNYU_AFT
WHERE UPDKBN IN(0,8) AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
) D1
WHERE D1.MOYSKBN=1 AND D1.MOYSSTDT=180310 AND D1.MOYSRBAN=52 AND D1.BMNCD=1
AND D1.KANRINO=7 AND D1.KANRIENO=0 AND D1.SHNCD='01035681'
;
--全特（アンケート有）_商品
SELECT * FROM INATK2.TOKTG_SHN;
--A11#DP10 3P A11H510
--★ 催し検索_商品（アンケート有）
SELECT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,D2.YORIFLG AS BMFG
,0 AS BMNO
,D1.BMNCD
,D1.KANRINO
,D1.SHNCD
,CASE WHEN LENGTH(TRIM(D2.PARNO))<>0 THEN D2.PARNO END AS PARNO
,CASE WHEN D2.CHLDNO<>0 THEN D2.CHLDNO END AS CHLDNO
,D2.ADDSHUKBN
,CASE WHEN D2.HBSTDT<>0 THEN D2.HBSTDT END AS HBSTDT
,CASE WHEN D2.HBEDDT<>0 THEN D2.HBEDDT END AS HBEDDT
,CASE WHEN D2.NNSTDT<>0 THEN D2.NNSTDT END AS NNSTDT
,CASE WHEN D2.NNEDDT<>0 THEN D2.NNEDDT END AS NNEDDT
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
(
	SELECT DISTINCT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,SHNCD FROM INAIF.AN_HANBAI_AFT
	WHERE UPDKBN=0 AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
	UNION
	SELECT DISTINCT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,SHNCD FROM INAIF.AN_NOUNYU_AFT
	WHERE UPDKBN IN(0,8) AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
) D1
LEFT OUTER JOIN INATK2.TOKTG_SHN D2
 ON (D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN AND D1.BMNCD=D2.BMNCD AND D1.KANRINO=D2.KANRINO AND D1.SHNCD=D2.SHNCD)


-- WHERE D1.MOYSKBN=1 AND D1.MOYSSTDT=180310 AND D1.MOYSRBAN=52 AND D1.BMNCD=1
-- AND D1.KANRINO=7 AND D1.SHNCD='01035681'
;
SELECT * FROM INATK.TOKTG_SHN
WHERE MOYSKBN=1 AND MOYSSTDT=180310 AND MOYSRBAN=52 AND BMNCD=1 AND KANRINO=7
AND KANRIENO=0 AND SHNCD='01035681'
;
SELECT * FROM INATK.TOKMM_SHN
WHERE MOYSKBN=1 AND MOYSSTDT=180310 AND MOYSRBAN=52 AND BMNCD=1 AND KANRINO=7
AND SHNCD='01035681'
;
--★ 催し検索_店舗（アンケート有）
SELECT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,D2.YORIFLG AS BMFG
,0 AS BMNO
,D1.BMNCD
,D1.KANRINO
,D1.TENCD
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
(
	SELECT DISTINCT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,TENCD FROM INAIF.AN_HANBAI_AFT
	WHERE UPDKBN=0 AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
	UNION
	SELECT DISTINCT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,TENCD FROM INAIF.AN_NOUNYU_AFT
	WHERE UPDKBN IN(0,8) AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
) D1
LEFT OUTER JOIN
 INATK2.TOKTG_SHN D2
 ON (D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN AND D1.BMNCD=D2.BMNCD AND D1.KANRINO=D2.KANRINO)

-- WHERE D1.MOYSKBN=1 AND D1.MOYSSTDT=180310 AND D1.MOYSRBAN=52 AND D1.BMNCD=1
-- AND D1.KANRINO=7 AND D1.KANRIENO=0 AND D1.SHNCD='01035681'
;

SELECT * FROM INATK.TOKMM_TEN
WHERE MOYSKBN=1 AND MOYSSTDT=180310 AND MOYSRBAN=52 AND BMNCD=1 AND KANRINO=7
ORDER BY TENCD;

--A11#DP10 4P A11H470
SELECT MOYSCD,BMNCD,KANRINO,KANRIENO,SHNCD,TENCD FROM INAIF.AN_HANBAI_NEQ
WHERE UPDKBN=0 AND
( (GTSIMECHGKBN=1 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=2 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=3 AND GTSIMEOKFLG=0)
OR(GTSIMECHGKBN=4 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=0 AND GTSIMEOKFLG=0)
)
;
--A11#DP10 4P A11H480
SELECT MOYSCD,BMNCD,KANRINO,KANRIENO,SHNCD,TENCD FROM INAIF.AN_NOUNYU_NEQ
WHERE UPDKBN IN(0,8) AND
( (GTSIMECHGKBN=1 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=2 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=3 AND GTSIMEOKFLG=0)
OR(GTSIMECHGKBN=4 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=0 AND GTSIMEOKFLG=0)
)
;
SELECT DISTINCT GTSIMECHGKBN,GTSIMEOKFLG FROM INAIF.AN_NOUNYU_NEQ;
SELECT * FROM INAIF.AN_NOUNYU_NEQ;
;
--A11#DP10 4P A11H490
SELECT * FROM (
SELECT MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,KANRIENO,SHNCD,TENCD FROM INAIF.AN_HANBAI_NEQ
WHERE UPDKBN=0 AND
( (GTSIMECHGKBN=1 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=2 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=3 AND GTSIMEOKFLG=0)
OR(GTSIMECHGKBN=4 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=0 AND GTSIMEOKFLG=0)
)
UNION
SELECT MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,KANRIENO,SHNCD,TENCD FROM INAIF.AN_NOUNYU_NEQ
WHERE UPDKBN IN(0,8) AND
( (GTSIMECHGKBN=1 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=2 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=3 AND GTSIMEOKFLG=0)
OR(GTSIMECHGKBN=4 AND GTSIMEOKFLG=1)
OR(GTSIMECHGKBN=0 AND GTSIMEOKFLG=0)
)
) D1
WHERE D1.MOYSKBN=2 AND D1.MOYSSTDT=180314 AND D1.MOYSRBAN=0 AND D1.BMNCD=1
AND D1.KANRINO=209 AND D1.KANRIENO=0 AND D1.SHNCD='01000098'
;
--A11#DP10 5P A11H520
--★ 催し検索_商品（アンケート無）
SELECT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,D2.YORIFLG AS BMFG
,0 AS BMNO
,D1.BMNCD
,D1.KANRINO
,D1.SHNCD
,CASE WHEN LENGTH(TRIM(D2.PARNO))<>0 THEN D2.PARNO END AS PARNO
,CASE WHEN D2.CHLDNO<>0 THEN D2.CHLDNO END AS CHLDNO
,D2.ADDSHUKBN
,CASE WHEN D2.HBSTDT<>0 THEN D2.HBSTDT END AS HBSTDT
,CASE WHEN D2.HBEDDT<>0 THEN D2.HBEDDT END AS HBEDDT
,CASE WHEN D2.NNSTDT<>0 THEN D2.NNSTDT END AS NNSTDT
,CASE WHEN D2.NNEDDT<>0 THEN D2.NNEDDT END AS NNEDDT
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
(
	SELECT DISTINCT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,SHNCD FROM INAIF.AN_HANBAI_NEQ
	WHERE UPDKBN=0 AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
	UNION
	SELECT DISTINCT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,SHNCD FROM INAIF.AN_NOUNYU_NEQ
	WHERE UPDKBN IN(0,8) AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
) D1

LEFT OUTER JOIN
 INATK2.TOKSP_SHN D2
 ON (D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN AND D1.BMNCD=D2.BMNCD AND D1.KANRINO=D2.KANRINO AND D1.SHNCD=D2.SHNCD)

-- WHERE D1.MOYSKBN=2 AND D1.MOYSSTDT=180314 AND D1.MOYSRBAN=0 AND D1.BMNCD=1
-- AND D1.KANRINO=209 AND D1.KANRIENO=0 AND D1.SHNCD='01000098'
;
SELECT * FROM INATK.TOKMM_SHN D1
WHERE D1.MOYSKBN=0 AND D1.MOYSSTDT=180326 AND D1.MOYSRBAN=0 AND D1.BMNCD=5
AND D1.KANRINO=111 AND D1.SHNCD='05005612'
;
--★ 催し検索_店舗（アンケート無）
SELECT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,D2.YORIFLG AS BMFG
,0 AS BMNO
,D1.BMNCD
,D1.KANRINO
,D1.TENCD
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
(
	SELECT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,TENCD FROM INAIF.AN_HANBAI_NEQ
	WHERE UPDKBN=0 AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
	UNION
	SELECT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,TENCD FROM INAIF.AN_NOUNYU_NEQ
	WHERE UPDKBN IN(0,8) AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
) D1
LEFT OUTER JOIN
 INATK2.TOKSP_SHN D2
 ON (D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN AND D1.BMNCD=D2.BMNCD AND D1.KANRINO=D2.KANRINO)
-- WHERE D1.MOYSKBN=2 AND D1.MOYSSTDT=180314 AND D1.MOYSRBAN=0 AND D1.BMNCD=1
-- AND D1.KANRINO=209 AND D1.KANRIENO=0
;

SELECT * FROM INATK.TOKMM_TEN D1
WHERE D1.MOYSKBN=2 AND D1.MOYSSTDT=180314 AND D1.MOYSRBAN=0 AND D1.BMNCD=1
AND D1.KANRINO=209
;

--A11#DP10 7P A11H540
--★催し検索用_Ｂ／Ｍ催し送信_商品
SELECT DISTINCT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,1 AS BMFLG
,D1.BMNO
,D1.BMNCD
,D1.KANRINO
,D1.SHNCD
,'000' AS PARNO
,CAST(NULL AS SMALLINT) AS CHLDNO
,CAST(NULL AS SMALLINT) AS ADDSHUKBN
,CASE WHEN D1.HBSTDT<>0 THEN D1.HBSTDT END AS HBSTDT
,CASE WHEN D1.HBEDDT<>0 THEN D1.HBEDDT END AS HBEDDT
,CAST(NULL AS INTEGER) AS NNSTDT
,CAST(NULL AS INTEGER) AS NNEDDT
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
INAIF.MS_HANBAI_BMS D1
WHERE D1.UPDKBN=0
;
SELECT * FROM INATK.TOKMM_SHN
WHERE MOYSKBN=1 AND MOYSSTDT=180401 AND MOYSRBAN=50 AND SHNCD='01002724';

SELECT * FROM INAIF.MS_HANBAI_BMS
WHERE MOYSKBN=1 AND MOYSSTDT=180401 AND MOYSRBAN=50 AND KANRINO=2 AND SHNCD='01002724';

SELECT * FROM INATK.TOKBM_SHN
WHERE MOYSKBN=1 AND MOYSSTDT=180401 AND MOYSRBAN=50 AND SHNCD='01002724';

--★ 催し検索用_Ｂ／Ｍ催し送信_店舗
SELECT DISTINCT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,1 AS BMFG
,D1.BMNO
,D1.BMNCD
,D1.KANRINO
,D1.TENCD
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
INAIF.MS_HANBAI_BMS D1
WHERE D1.UPDKBN=0
;
SELECT * FROM INATK.TOKMM_TEN
WHERE MOYSKBN=2 AND MOYSSTDT=180312 AND MOYSRBAN=0 AND BMFLG=1 AND BMNO=4;

--A11#DP10 8P A11R110
--★生活応援 催し検索_商品ﾃﾞｰﾀ
SELECT DISTINCT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,0 AS BMFLG
,0 AS BMNO
,D1.BMNCD
,D1.KANRINO
,D1.SHNCD
,'000' AS PARNO
,CAST(NULL AS SMALLINT) AS CHLDNO
,CAST(NULL AS SMALLINT) AS ADDSHUKBN
,CASE WHEN D2.HBSTDT<>0 THEN D2.HBSTDT END AS HBSTDT
,CASE WHEN D2.HBEDDT<>0 THEN D2.HBEDDT END AS HBEDDT
,CASE WHEN D2.NNSTDT<>0 THEN D2.NNSTDT END AS HBSTDT
,CASE WHEN D2.NNEDDT<>0 THEN D2.NNEDDT END AS HBEDDT
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
INATK2.TOKSO_SHN D1
INNER JOIN INATK2.TOKMOYCD D2
ON D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN
WHERE D1.UPDKBN=0
;
SELECT * FROM INATK.TOKMM_SHN
WHERE MOYSKBN=5 AND MOYSSTDT=170130 AND MOYSRBAN=20 AND BMFLG=0 AND BMNO=0 AND SHNCD='01277863';

--★ 生活応援 催し検索_店舗ﾃﾞｰﾀ
SELECT DISTINCT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,0 AS BMFG
,0 AS BMNO
,D1.BMNCD
,D1.KANRINO
,NUMS.TENCD
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
INATK2.TOKSO_SHN D1
INNER JOIN INATK2.TOKMOYCD D2
ON D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN
LEFT OUTER JOIN
(
    SELECT
        NUMS.SEQ AS TENCD
    FROM
        INAPARM.MSTNUMS NUMS
    WHERE
        NUMS.SEQ BETWEEN 1 AND 400
) NUMS
ON
    1 = 1
WHERE D1.UPDKBN=0
AND TRIM(SUBSTR(D1.TENATSUK_ARR, NUMS.TENCD, 1)) <> ''
;
SELECT * FROM INATK.TOKMM_TEN
WHERE MOYSKBN=5 AND MOYSSTDT=161207 AND MOYSRBAN=26 AND BMNCD=3 AND KANRINO=35 AND TENCD=150
;
--A11#DP10 9P ※月間山積は廃止


--A11#DP10 10P A11R130
--★事前打出 催し検索_商品ﾃﾞｰﾀ
SELECT DISTINCT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,0 AS BMFLG
,0 AS BMNO
,SMALLINT('0' || SUBSTR(D1.SHNCD, 1, 2)) AS BMNCD
,D1.KANRINO
,D1.SHNCD
,'000' AS PARNO
,CAST(NULL AS SMALLINT) AS CHLDNO
,CAST(NULL AS SMALLINT) AS ADDSHUKBN
,CASE WHEN D2.HBSTDT<>0 THEN D2.HBSTDT END AS HBSTDT
,CASE WHEN D2.HBEDDT<>0 THEN D2.HBEDDT END AS HBEDDT
,CASE WHEN D2.NNSTDT<>0 THEN D2.NNSTDT END AS HBSTDT
,CASE WHEN D2.NNEDDT<>0 THEN D2.NNEDDT END AS HBEDDT
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
INATK2.TOKJU_SHN D1
INNER JOIN INATK2.TOKMOYCD D2
ON D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN
WHERE D1.UPDKBN=0
;
SELECT * FROM INATK.TOKMM_SHN
WHERE MOYSKBN=9 AND MOYSSTDT=180301 AND MOYSRBAN=1 AND BMFLG=0 AND BMNO=0 AND SHNCD='01289799';

--★ 事前打出 催し検索_店舗ﾃﾞｰﾀ
SELECT DISTINCT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,0 AS BMFG
,0 AS BMNO
,SMALLINT('0' || SUBSTR(D1.SHNCD, 1, 2)) AS BMNCD
,D1.KANRINO
,NUMS.TENCD
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
INATK2.TOKJU_SHN D1
INNER JOIN INATK2.TOKMOYCD D2
ON D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN
LEFT OUTER JOIN
(
    SELECT
        NUMS.SEQ AS TENCD
    FROM
        INAPARM.MSTNUMS NUMS
    WHERE
        NUMS.SEQ BETWEEN 1 AND 400
) NUMS
ON
    1 = 1
WHERE D1.UPDKBN=0
AND TRIM(SUBSTR(D1.TENHTSU_ARR, (NUMS.TENCD-1)*5+1, 5)) <> ''
;
SELECT * FROM INATK.TOKMM_TEN
WHERE MOYSKBN=9 AND MOYSSTDT=180301 AND MOYSRBAN=0 AND BMNCD=11 AND KANRINO=1 AND TENCD=13
;

--A11#DP10 11P A11R130
--★店舗送付け→店舗アンケート付き送付け 催し検索_商品ﾃﾞｰﾀ
SELECT DISTINCT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,0 AS BMFLG
,0 AS BMNO
,SMALLINT('0' || SUBSTR(D1.SHNCD, 1, 2)) AS BMNCD
,D1.KANRINO
,D1.SHNCD
,'000' AS PARNO
,CAST(NULL AS SMALLINT) AS CHLDNO
,CAST(NULL AS SMALLINT) AS ADDSHUKBN
,CASE WHEN D2.HBSTDT<>0 THEN D2.HBSTDT END AS HBSTDT
,CASE WHEN D2.HBEDDT<>0 THEN D2.HBEDDT END AS HBEDDT
,CASE WHEN D2.NNSTDT<>0 THEN D2.NNSTDT END AS HBSTDT
,CASE WHEN D2.NNEDDT<>0 THEN D2.NNEDDT END AS HBEDDT
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
INATK2.TOKQJU_SHN D1
INNER JOIN INATK2.TOKMOYCD D2
ON D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN
WHERE D1.UPDKBN=0
;
SELECT * FROM INATK.TOKMM_SHN
WHERE MOYSKBN=8 AND MOYSSTDT=180317 AND MOYSRBAN=34 AND BMFLG=0 AND BMNO=0 AND SHNCD='34022643';

--★ 店舗送付け→店舗アンケート付き送付け 催し検索_店舗ﾃﾞｰﾀ
SELECT DISTINCT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,0 AS BMFG
,0 AS BMNO
,SMALLINT('0' || SUBSTR(D1.SHNCD, 1, 2)) AS BMNCD
,D1.KANRINO
,NUMS.TENCD
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
INATK2.TOKQJU_SHN D1
INNER JOIN INATK2.TOKMOYCD D2
ON D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN
LEFT OUTER JOIN
(
    SELECT
        NUMS.SEQ AS TENCD
    FROM
        INAPARM.MSTNUMS NUMS
    WHERE
        NUMS.SEQ BETWEEN 1 AND 400
) NUMS
ON
    1 = 1
WHERE D1.UPDKBN=0
AND TRIM(SUBSTR(D1.TENHTSU_ARR, (NUMS.TENCD-1)*5+1, 5)) <> ''
;
SELECT * FROM INATK.TOKMM_TEN
WHERE MOYSKBN=8 AND MOYSSTDT=180310 AND MOYSRBAN=1 AND BMNCD=1 AND KANRINO=2 AND TENCD=4
;

--A11#DP10 12P ※個店特売は廃止

--A11#DP10 13P 催し検索_商品
SELECT MOYSKBN,COUNT(*) FROM (
--★ 催し検索_商品（アンケート有）
SELECT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,D2.YORIFLG AS BMFG
,0 AS BMNO
,D1.BMNCD
,D1.KANRINO
,D1.SHNCD
,CASE WHEN LENGTH(TRIM(D2.PARNO))<>0 THEN D2.PARNO END AS PARNO
,CASE WHEN D2.CHLDNO<>0 THEN D2.CHLDNO END AS CHLDNO
,D2.ADDSHUKBN
,CASE WHEN D2.HBSTDT<>0 THEN D2.HBSTDT END AS HBSTDT
,CASE WHEN D2.HBEDDT<>0 THEN D2.HBEDDT END AS HBEDDT
,CASE WHEN D2.NNSTDT<>0 THEN D2.NNSTDT END AS NNSTDT
,CASE WHEN D2.NNEDDT<>0 THEN D2.NNEDDT END AS NNEDDT
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
(
	SELECT DISTINCT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,SHNCD FROM INAIF.AN_HANBAI_AFT
	WHERE UPDKBN=0 AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
	UNION
	SELECT DISTINCT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,SHNCD FROM INAIF.AN_NOUNYU_AFT
	WHERE UPDKBN IN(0,8) AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
) D1
LEFT OUTER JOIN INATK2.TOKTG_SHN D2
 ON (D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN AND D1.BMNCD=D2.BMNCD AND D1.KANRINO=D2.KANRINO AND D1.SHNCD=D2.SHNCD)

UNION ALL

--★ 催し検索_商品（アンケート無）
SELECT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,D2.YORIFLG AS BMFG
,0 AS BMNO
,D1.BMNCD
,D1.KANRINO
,D1.SHNCD
,CASE WHEN LENGTH(TRIM(D2.PARNO))<>0 THEN D2.PARNO END AS PARNO
,CASE WHEN D2.CHLDNO<>0 THEN D2.CHLDNO END AS CHLDNO
,D2.ADDSHUKBN
,CASE WHEN D2.HBSTDT<>0 THEN D2.HBSTDT END AS HBSTDT
,CASE WHEN D2.HBEDDT<>0 THEN D2.HBEDDT END AS HBEDDT
,CASE WHEN D2.NNSTDT<>0 THEN D2.NNSTDT END AS NNSTDT
,CASE WHEN D2.NNEDDT<>0 THEN D2.NNEDDT END AS NNEDDT
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
(
	SELECT DISTINCT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,SHNCD FROM INAIF.AN_HANBAI_NEQ
	WHERE UPDKBN=0 AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
	UNION
	SELECT DISTINCT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,SHNCD FROM INAIF.AN_NOUNYU_NEQ
	WHERE UPDKBN IN(0,8) AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
) D1

LEFT OUTER JOIN
 INATK2.TOKSP_SHN D2
 ON (D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN AND D1.BMNCD=D2.BMNCD AND D1.KANRINO=D2.KANRINO AND D1.SHNCD=D2.SHNCD)

UNION ALL

--★催し検索用_Ｂ／Ｍ催し送信_商品
SELECT DISTINCT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,1 AS BMFLG
,D1.BMNO
,D1.BMNCD
,D1.KANRINO
,D1.SHNCD
,'000' AS PARNO
,CAST(NULL AS SMALLINT) AS CHLDNO
,CAST(NULL AS SMALLINT) AS ADDSHUKBN
,CASE WHEN D1.HBSTDT<>0 THEN D1.HBSTDT END AS HBSTDT
,CASE WHEN D1.HBEDDT<>0 THEN D1.HBEDDT END AS HBEDDT
,CAST(NULL AS INTEGER) AS NNSTDT
,CAST(NULL AS INTEGER) AS NNEDDT
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
INAIF.MS_HANBAI_BMS D1
WHERE D1.UPDKBN=0

UNION ALL

--★生活応援 催し検索_商品ﾃﾞｰﾀ
SELECT DISTINCT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,0 AS BMFLG
,0 AS BMNO
,D1.BMNCD
,D1.KANRINO
,D1.SHNCD
,'000' AS PARNO
,CAST(NULL AS SMALLINT) AS CHLDNO
,CAST(NULL AS SMALLINT) AS ADDSHUKBN
,CASE WHEN D2.HBSTDT<>0 THEN D2.HBSTDT END AS HBSTDT
,CASE WHEN D2.HBEDDT<>0 THEN D2.HBEDDT END AS HBEDDT
,CASE WHEN D2.NNSTDT<>0 THEN D2.NNSTDT END AS HBSTDT
,CASE WHEN D2.NNEDDT<>0 THEN D2.NNEDDT END AS HBEDDT
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
INATK2.TOKSO_SHN D1
INNER JOIN INATK2.TOKMOYCD D2
ON D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN
WHERE D1.UPDKBN=0

UNION ALL

--★事前打出 催し検索_商品ﾃﾞｰﾀ
SELECT DISTINCT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,0 AS BMFLG
,0 AS BMNO
,SMALLINT('0' || SUBSTR(D1.SHNCD, 1, 2)) AS BMNCD
,D1.KANRINO
,D1.SHNCD
,'000' AS PARNO
,CAST(NULL AS SMALLINT) AS CHLDNO
,CAST(NULL AS SMALLINT) AS ADDSHUKBN
,CASE WHEN D2.HBSTDT<>0 THEN D2.HBSTDT END AS HBSTDT
,CASE WHEN D2.HBEDDT<>0 THEN D2.HBEDDT END AS HBEDDT
,CASE WHEN D2.NNSTDT<>0 THEN D2.NNSTDT END AS HBSTDT
,CASE WHEN D2.NNEDDT<>0 THEN D2.NNEDDT END AS HBEDDT
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
INATK2.TOKJU_SHN D1
INNER JOIN INATK2.TOKMOYCD D2
ON D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN
WHERE D1.UPDKBN=0

UNION ALL

--★店舗送付け→店舗アンケート付き送付け 催し検索_商品ﾃﾞｰﾀ
SELECT DISTINCT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,0 AS BMFLG
,0 AS BMNO
,SMALLINT('0' || SUBSTR(D1.SHNCD, 1, 2)) AS BMNCD
,D1.KANRINO
,D1.SHNCD
,'000' AS PARNO
,CAST(NULL AS SMALLINT) AS CHLDNO
,CAST(NULL AS SMALLINT) AS ADDSHUKBN
,CASE WHEN D2.HBSTDT<>0 THEN D2.HBSTDT END AS HBSTDT
,CASE WHEN D2.HBEDDT<>0 THEN D2.HBEDDT END AS HBEDDT
,CASE WHEN D2.NNSTDT<>0 THEN D2.NNSTDT END AS HBSTDT
,CASE WHEN D2.NNEDDT<>0 THEN D2.NNEDDT END AS HBEDDT
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
INATK2.TOKQJU_SHN D1
INNER JOIN INATK2.TOKMOYCD D2
ON D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN
WHERE D1.UPDKBN=0
) X GROUP BY X.MOYSKBN
;
SELECT MOYSKBN,COUNT(*) FROM INATK.TOKMM_SHN GROUP BY MOYSKBN;


--A11#DP10 14P 催し検索_店舗
SELECT MOYSKBN,COUNT(*) FROM (
--★ 催し検索_店舗（アンケート有）
SELECT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,D2.YORIFLG AS BMFG
,0 AS BMNO
,D1.BMNCD
,D1.KANRINO
,D1.TENCD
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
(
	SELECT DISTINCT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,TENCD FROM INAIF.AN_HANBAI_AFT
	WHERE UPDKBN=0 AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
	UNION
	SELECT DISTINCT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,TENCD FROM INAIF.AN_NOUNYU_AFT
	WHERE UPDKBN IN(0,8) AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
) D1
LEFT OUTER JOIN
 INATK2.TOKTG_SHN D2
 ON (D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN AND D1.BMNCD=D2.BMNCD AND D1.KANRINO=D2.KANRINO)

UNION ALL

--★ 催し検索_店舗（アンケート無）
SELECT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,D2.YORIFLG AS BMFG
,0 AS BMNO
,D1.BMNCD
,D1.KANRINO
,D1.TENCD
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
(
	SELECT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,TENCD FROM INAIF.AN_HANBAI_NEQ
	WHERE UPDKBN=0 AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
	UNION
	SELECT MOYSCD,MOYSKBN,MOYSSTDT,MOYSRBAN,BMNCD,KANRINO,TENCD FROM INAIF.AN_NOUNYU_NEQ
	WHERE UPDKBN IN(0,8) AND ((GTSIMECHGKBN = 1 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 2 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 3 AND GTSIMEOKFLG = 0) OR (GTSIMECHGKBN = 4 AND GTSIMEOKFLG = 1) OR (GTSIMECHGKBN = 0 AND GTSIMEOKFLG = 0))
) D1
LEFT OUTER JOIN
 INATK2.TOKSP_SHN D2
 ON (D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN AND D1.BMNCD=D2.BMNCD AND D1.KANRINO=D2.KANRINO)

UNION ALL

--★ 催し検索用_Ｂ／Ｍ催し送信_店舗
SELECT DISTINCT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,1 AS BMFG
,D1.BMNO
,D1.BMNCD
,D1.KANRINO
,D1.TENCD
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
INAIF.MS_HANBAI_BMS D1
WHERE D1.UPDKBN=0

UNION ALL

--★ 生活応援 催し検索_店舗ﾃﾞｰﾀ
SELECT DISTINCT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,0 AS BMFG
,0 AS BMNO
,D1.BMNCD
,D1.KANRINO
,NUMS.TENCD
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
INATK2.TOKSO_SHN D1
INNER JOIN INATK2.TOKMOYCD D2
ON D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN
LEFT OUTER JOIN
(
    SELECT
        NUMS.SEQ AS TENCD
    FROM
        INAPARM.MSTNUMS NUMS
    WHERE
        NUMS.SEQ BETWEEN 1 AND 400
) NUMS
ON
    1 = 1
WHERE D1.UPDKBN=0
AND TRIM(SUBSTR(D1.TENATSUK_ARR, NUMS.TENCD, 1)) <> ''

UNION ALL

--★ 事前打出 催し検索_店舗ﾃﾞｰﾀ
SELECT DISTINCT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,0 AS BMFG
,0 AS BMNO
,SMALLINT('0' || SUBSTR(D1.SHNCD, 1, 2)) AS BMNCD
,D1.KANRINO
,NUMS.TENCD
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
INATK2.TOKJU_SHN D1
INNER JOIN INATK2.TOKMOYCD D2
ON D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN
LEFT OUTER JOIN
(
    SELECT
        NUMS.SEQ AS TENCD
    FROM
        INAPARM.MSTNUMS NUMS
    WHERE
        NUMS.SEQ BETWEEN 1 AND 400
) NUMS
ON
    1 = 1
WHERE D1.UPDKBN=0
AND TRIM(SUBSTR(D1.TENHTSU_ARR, (NUMS.TENCD-1)*5+1, 5)) <> ''

UNION ALL

--★ 店舗送付け→店舗アンケート付き送付け 催し検索_店舗ﾃﾞｰﾀ
SELECT DISTINCT
 D1.MOYSKBN
,D1.MOYSSTDT
,D1.MOYSRBAN
,0 AS BMFG
,0 AS BMNO
,SMALLINT('0' || SUBSTR(D1.SHNCD, 1, 2)) AS BMNCD
,D1.KANRINO
,NUMS.TENCD
,'BATCH' AS OP
,CURRENT_TIMESTAMP AS ADT
,CURRENT_TIMESTAMP AS UDT
FROM
INATK2.TOKQJU_SHN D1
INNER JOIN INATK2.TOKMOYCD D2
ON D1.MOYSKBN=D2.MOYSKBN AND D1.MOYSSTDT=D2.MOYSSTDT AND D1.MOYSRBAN=D2.MOYSRBAN
LEFT OUTER JOIN
(
    SELECT
        NUMS.SEQ AS TENCD
    FROM
        INAPARM.MSTNUMS NUMS
    WHERE
        NUMS.SEQ BETWEEN 1 AND 400
) NUMS
ON
    1 = 1
WHERE D1.UPDKBN=0
AND TRIM(SUBSTR(D1.TENHTSU_ARR, (NUMS.TENCD-1)*5+1, 5)) <> ''

) X GROUP BY X.MOYSKBN
;
SELECT MOYSKBN,COUNT(*) FROM INATK.TOKMM_TEN GROUP BY MOYSKBN;
