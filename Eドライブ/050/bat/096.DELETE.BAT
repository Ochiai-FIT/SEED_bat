REM [026][069_LOAD]
@ECHO OFF

REM ログフォルダ作成
IF NOT EXIST %~DP0..\logs MKDIR %~DP0..\logs

REM コマンドフォルダ作成
IF NOT EXIST %~DP0..\cmd MKDIR %~DP0..\cmd

REM ログファイルの情報
SET OUTFILE=%~DP0../logs/setup.log
SET OUTTIME=%~DP0../logs/time.log

REM ベースフォルダ
SET BASEDIR=%~DP0..

REM 更新対象の情報
SET INFOSCRIPT=%~DP0..\cmd\%~N0.DB2


SET INFILENAME=
SET MSG=%DATE% %TIME% 全特(アンケート無)_商品納入日 INATK.TOKSP_SHNNNDT BACKUP処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
SET OUTFILENAME=%~DP0..\DATA\INATK.TOKSP_SHNNNDT
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% -N -e "SELECT COALESCE(SHNCD, '') || ',' || COALESCE(BINKBN, '') || ',' || COALESCE(NNDT, '') || ',' || COALESCE(MOYCD_ARR, '') || ',' || COALESCE(KANRINO_ARR, '') || ',' || COALESCE(OPERATOR, '') || ',' || COALESCE(ADDDT, '') || ',' || COALESCE(UPDDT, '') FROM INATK.TOKSP_SHNNNDT;" >%OUTFILENAME% 2>>%OUTFILE%
IF NOT %ERRORLEVEL%==0 GOTO ERROR

SET MSG=%DATE% %TIME% 全特(アンケート無)_商品納入日 INATK.TOKSP_SHNNNDT DELETE処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% --show-warnings -vv -e "DELETE FROM INATK.TOKSP_SHNNNDT T1 WHERE EXISTS (SELECT 1 FROM (SELECT CAST(DATE_FORMAT(DATE_FORMAT(SHORIDT, '%%Y%%m%%d') - INTERVAL 1 DAY - INTERVAL X.MWDSU DAY, '%%Y%%m%%d') AS SIGNED) AS SHORIDT FROM INAAD.SYSSHORIDT, (SELECT MWDSU FROM INAAD.SYSTOKDELCTL WHERE P_TABLENM = 'TOKSP_SHNNNDT' AND PTNCD = '1') X) T2 WHERE T1.NNDT <= T2.SHORIDT);commit;" >>%OUTFILE% 2>&1
IF %ERRORLEVEL% GTR 1 GOTO ERROR


SET MSG=%DATE% %TIME% 本部個特_商品納入日 INATK.TOKHTK_SHNNNDT BACKUP処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
SET OUTFILENAME=%~DP0..\DATA\INATK.TOKHTK_SHNNNDT
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% -N -e "SELECT COALESCE(SHNCD, '') || ',' || COALESCE(BINKBN, '') || ',' || COALESCE(NNDT, '') || ',' || COALESCE(MOYCD_ARR, '') || ',' || COALESCE(KANRINO_ARR, '') || ',' || COALESCE(OPERATOR, '') || ',' || COALESCE(ADDDT, '') || ',' || COALESCE(UPDDT, '') FROM INATK.TOKHTK_SHNNNDT;" >%OUTFILENAME% 2>>%OUTFILE%
IF NOT %ERRORLEVEL%==0 GOTO ERROR

SET MSG=%DATE% %TIME% 本部個特_商品納入日 INATK.TOKHTK_SHNNNDT DELETE処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% --show-warnings -vv -e "DELETE FROM INATK.TOKHTK_SHNNNDT T1 WHERE EXISTS (SELECT 1 FROM (SELECT CAST(DATE_FORMAT(DATE_FORMAT(SHORIDT, '%%Y%%m%%d') - INTERVAL 1 DAY - INTERVAL X.MWDSU DAY, '%%Y%%m%%d') AS SIGNED) AS SHORIDT FROM INAAD.SYSSHORIDT, (SELECT MWDSU FROM INAAD.SYSTOKDELCTL WHERE P_TABLENM = 'TOKHTK_SHNNNDT' AND PTNCD = '1') X) T2 WHERE T1.NNDT <= T2.SHORIDT);commit;" >>%OUTFILE% 2>&1
IF %ERRORLEVEL% GTR 1 GOTO ERROR


SET MSG=%DATE% %TIME% 事前打出し_商品納入日 INATK.TOKJU_SHNNNDT BACKUP処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
SET OUTFILENAME=%~DP0..\DATA\INATK.TOKJU_SHNNNDT
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% -N -e "SELECT COALESCE(SHNCD, '') || ',' || COALESCE(NNDT, '') || ',' || COALESCE(MOYCD_ARR, '') || ',' || COALESCE(KANRINO_ARR, '') || ',' || COALESCE(DBLCNT_ARR, '') || ',' || COALESCE(OPERATOR, '') || ',' || COALESCE(ADDDT, '') || ',' || COALESCE(UPDDT, '') FROM INATK.TOKJU_SHNNNDT;" >%OUTFILENAME% 2>>%OUTFILE%
IF %ERRORLEVEL% GTR 1 GOTO ERROR

SET MSG=%DATE% %TIME% 事前打出し_商品納入日 INATK.TOKJU_SHNNNDT DELETE処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% --show-warnings -vv -e "DELETE FROM INATK.TOKJU_SHNNNDT T1 WHERE EXISTS (SELECT 1 FROM (SELECT CAST(DATE_FORMAT(DATE_FORMAT(SHORIDT, '%%Y%%m%%d') - INTERVAL 1 DAY - INTERVAL X.MWDSU DAY, '%%Y%%m%%d') AS SIGNED) AS SHORIDT FROM INAAD.SYSSHORIDT, (SELECT MWDSU FROM INAAD.SYSTOKDELCTL WHERE P_TABLENM = 'TOKJU_SHNNNDT' AND PTNCD = '1') X) T2 WHERE T1.NNDT <= T2.SHORIDT);commit;" >>%OUTFILE% 2>&1
IF %ERRORLEVEL% GTR 1 GOTO ERROR


SET MSG=%DATE% %TIME% 全特_商品販売日 INATK.TOKSP_SHNHBDT BACKUP処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
SET OUTFILENAME=%~DP0..\DATA\INATK.TOKSP_SHNHBDT
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% -N -e "SELECT COALESCE(RPAD(SHNCD,14,' '), '') || ',' || COALESCE(HBDT, '') || ',' || COALESCE(MOYCD_ARR, '') || ',' || COALESCE(KANRINO_ARR, '') || ',' || COALESCE(OPERATOR, '') || ',' || COALESCE(ADDDT, '') || ',' || COALESCE(UPDDT, '') FROM INATK.TOKSP_SHNHBDT" >%OUTFILENAME% 2>>%OUTFILE%
IF %ERRORLEVEL% GTR 1 GOTO ERROR


SET MSG=%DATE% %TIME% 全特_商品販売日 INATK.TOKSP_SHNHBDT DELETE処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% --show-warnings -vv -e "DELETE FROM INATK.TOKSP_SHNHBDT T1 WHERE EXISTS (SELECT 1 FROM (SELECT CAST(DATE_FORMAT(DATE_FORMAT(SHORIDT, '%%Y%%m%%d') - INTERVAL 1 DAY - INTERVAL X.MWDSU DAY, '%%Y%%m%%d') AS SIGNED) AS SHORIDT FROM INAAD.SYSSHORIDT, (SELECT MWDSU FROM INAAD.SYSTOKDELCTL WHERE P_TABLENM = 'TOKSP_SHNHBDT' AND PTNCD = '1') X) T2 WHERE T1.HBDT <= T2.SHORIDT);commit;" >>%OUTFILE% 2>&1
IF %ERRORLEVEL% GTR 1 GOTO ERROR


SET MSG=%DATE% %TIME% 本部個特_商品販売日 INATK.TOKHTK_SHNHBDT BACKUP処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
SET OUTFILENAME=%~DP0..\DATA\INATK.TOKHTK_SHNHBDT
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% -N -e "SELECT COALESCE(SHNCD, '') || ',' || COALESCE(HBDT, '') || ',' || COALESCE(MOYCD_ARR, '') || ',' || COALESCE(KANRINO_ARR, '') || ',' || COALESCE(OPERATOR, '') || ',' || COALESCE(ADDDT, '') || ',' || COALESCE(UPDDT, '') FROM INATK.TOKHTK_SHNHBDT;" >%OUTFILENAME% 2>>%OUTFILE%
IF %ERRORLEVEL% GTR 1 GOTO ERROR

SET MSG=%DATE% %TIME% 本部個特_商品販売日 INATK.TOKHTK_SHNHBDT DELETE処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% --show-warnings -vv -e "DELETE FROM INATK.TOKHTK_SHNHBDT T1 WHERE EXISTS (SELECT 1 FROM (SELECT CAST(DATE_FORMAT(DATE_FORMAT(SHORIDT, '%%Y%%m%%d') - INTERVAL 1 DAY - INTERVAL X.MWDSU DAY, '%%Y%%m%%d') AS SIGNED) AS SHORIDT FROM INAAD.SYSSHORIDT, (SELECT MWDSU FROM INAAD.SYSTOKDELCTL WHERE P_TABLENM = 'TOKHTK_SHNHBDT' AND PTNCD = '1') X) T2 WHERE T1.HBDT <= T2.SHORIDT);commit;" >>%OUTFILE% 2>&1
IF %ERRORLEVEL% GTR 1 GOTO ERROR


SET MSG=%DATE% %TIME% B/M商品販売日 INATK.TOKBM_SHNHBDT BACKUP処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
SET OUTFILENAME=%~DP0..\DATA\INATK.TOKBM_SHNHBDT
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% -N -e "SELECT COALESCE(SHNCD, '') || ',' || COALESCE(HBDT, '') || ',' || COALESCE(MOYCD_ARR, '') || ',' || COALESCE(KANRINO_ARR, '') || ',' || COALESCE(BMNNO_ARR, '') || ',' || COALESCE(OPERATOR, '') || ',' || COALESCE(ADDDT, '') || ',' || COALESCE(UPDDT, '') FROM INATK.TOKBM_SHNHBDT" >%OUTFILENAME% 2>>%OUTFILE%
IF %ERRORLEVEL% GTR 1 GOTO ERROR


SET MSG=%DATE% %TIME% B/M商品販売日 INATK.TOKBM_SHNHBDT DELETE処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% --show-warnings -vv -e "DELETE FROM INATK.TOKBM_SHNHBDT T1 WHERE EXISTS (SELECT 1 FROM (SELECT CAST(DATE_FORMAT(DATE_FORMAT(SHORIDT, '%%Y%%m%%d') - INTERVAL 1 DAY - INTERVAL X.MWDSU DAY, '%%Y%%m%%d') AS SIGNED) AS SHORIDT FROM INAAD.SYSSHORIDT, (SELECT MWDSU FROM INAAD.SYSTOKDELCTL WHERE P_TABLENM = 'TOKBM_SHNHBDT' AND PTNCD = '1') X) T2 WHERE T1.HBDT <= T2.SHORIDT);commit;" >>%OUTFILE% 2>&1
IF %ERRORLEVEL% GTR 1 GOTO ERROR

SET MSG=%DATE% %TIME% B/M商品販売日_本部個特 INATK.TOKBM_SHNHBDT_HTK BACKUP処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
SET OUTFILENAME=%~DP0..\DATA\INATK.TOKBM_SHNHBDT_HTK
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% -N -e "SELECT COALESCE(RPAD(SHNCD, 14, ' '), '') || ',' || COALESCE(HBDT, '') || ',' || COALESCE(MOYCD_ARR, '') || ',' || COALESCE(KANRINO_ARR, '') || ',' || COALESCE(BMNNO_ARR, '') || ',' || COALESCE(OPERATOR, '') || ',' || COALESCE(ADDDT, '') || ',' || COALESCE(UPDDT, '') FROM INATK.TOKBM_SHNHBDT_HTK" >%OUTFILENAME% 2>>%OUTFILE%
IF %ERRORLEVEL% GTR 1 GOTO ERROR


SET MSG=%DATE% %TIME% B/M商品販売日_本部個特 INATK.TOKBM_SHNHBDT_HTK DELETE処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% --show-warnings -vv -e"DELETE FROM INATK.TOKBM_SHNHBDT_HTK T1 WHERE EXISTS (SELECT 1 FROM (SELECT CAST(DATE_FORMAT(DATE_FORMAT(SHORIDT, '%%Y%%m%%d') - INTERVAL 1 DAY - INTERVAL X.MWDSU DAY, '%%Y%%m%%d') AS SIGNED) AS SHORIDT FROM INAAD.SYSSHORIDT, (SELECT MWDSU FROM INAAD.SYSTOKDELCTL WHERE P_TABLENM = 'TOKBM_SHNHBDT_HTK' AND PTNCD = '1') X) T2 WHERE T1.HBDT <= T2.SHORIDT);commit;" >>%OUTFILE% 2>&1
IF %ERRORLEVEL% GTR 1 GOTO ERROR



:FINAL
EXIT /B 0

:ERROR
EXIT /B 1
