REM [026][069_LOAD]
@ECHO OFF

REM ログフォルダ作成
IF NOT EXIST %~DP0..\logs MKDIR %~DP0..\logs

REM コマンドフォルダ作成
IF NOT EXIST %~DP0..\cmd MKDIR %~DP0..\cmd

REM ログファイルの情報
SET OUTFILE=%~DP0../logs/setup.log
SET OUTTIME=%~DP0../logs/time.log

REM ベースフォルダ
SET BASEDIR=%~DP0..

REM 更新対象の情報
SET INFOSCRIPT=%~DP0..\cmd\%~N0.DB2


SET INFILENAME=
SET MSG=%DATE% %TIME% 事前発注_店舗_JNL INATK.JNL_TOKTJ_TEN BACKUP処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
SET OUTFILENAME=%~DP0..\DATA\INATK.JNL_TOKTJ_TEN
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% -N -e "SELECT COALESCE(SEQ, '') || ',' || COALESCE(LSTNO, '') || ',' || COALESCE(BMNCD, '') || ',' || COALESCE(HYOSEQNO, '') || ',' || COALESCE(TENCD, '') || ',' || COALESCE(IRISU_RG, '') || ',' || COALESCE(IRISU_TB, '') || ',' || COALESCE(SBAIKAAM_TB, '') || ',' || COALESCE(BAIKAAM_TB, '') || ',' || COALESCE(SBAIKAAM_RG, '') || ',' || COALESCE(BAIKAAM_RG, '') || ',' || COALESCE(GENKAAM_MAE, '') || ',' || COALESCE(GENKAAM_ATO, '') || ',' || COALESCE(GENKAAM_RG, '') || ',' || COALESCE(GENKAAM_PACK, '') || ',' || COALESCE(BAIKAAM_PACK, '') || ',' || COALESCE(JTDT_01, '') || ',' || COALESCE(JTDT_02, '') || ',' || COALESCE(JTDT_03, '') || ',' || COALESCE(JTDT_04, '') || ',' || COALESCE(JTDT_05, '') || ',' || COALESCE(JTDT_06, '') || ',' || COALESCE(JTDT_07, '') || ',' || COALESCE(JTDT_08, '') || ',' || COALESCE(JTDT_09, '') || ',' || COALESCE(JTDT_10, '') || ',' || COALESCE(TSEIKBN_01, '') || ',' || COALESCE(TSEIKBN_02, '') || ',' || COALESCE(TSEIKBN_03, '') || ',' || COALESCE(TSEIKBN_04, '') || ',' || COALESCE(TSEIKBN_05, '') || ',' || COALESCE(TSEIKBN_06, '') || ',' || COALESCE(TSEIKBN_07, '') || ',' || COALESCE(TSEIKBN_08, '') || ',' || COALESCE(TSEIKBN_09, '') || ',' || COALESCE(TSEIKBN_10, '') || ',' || COALESCE(SHNKBN_01, '') || ',' || COALESCE(SHNKBN_02, '') || ',' || COALESCE(SHNKBN_03, '') || ',' || COALESCE(SHNKBN_04, '') || ',' || COALESCE(SHNKBN_05, '') || ',' || COALESCE(SHNKBN_06, '') || ',' || COALESCE(SHNKBN_07, '') || ',' || COALESCE(SHNKBN_08, '') || ',' || COALESCE(SHNKBN_09, '') || ',' || COALESCE(SHNKBN_10, '') || ',' || COALESCE(HTSU_01, '') || ',' || COALESCE(HTSU_02, '') || ',' || COALESCE(HTSU_03, '') || ',' || COALESCE(HTSU_04, '') || ',' || COALESCE(HTSU_05, '') || ',' || COALESCE(HTSU_06, '') || ',' || COALESCE(HTSU_07, '') || ',' || COALESCE(HTSU_08, '') || ',' || COALESCE(HTSU_09, '') || ',' || COALESCE(HTSU_10, '') || ',' || COALESCE(PAGENO, '') || ',' || COALESCE(SENDFLG, '') || ',' || COALESCE(OPERATOR, '') || ',' || COALESCE(ADDDT, '') || ',' || COALESCE(UPDDT, '') FROM INATK.JNL_TOKTJ_TEN;" >%OUTFILENAME% 2>>%OUTFILE%
IF NOT %ERRORLEVEL%==0 GOTO ERROR

SET MSG=%DATE% %TIME% 事前発注_店舗_JNL INATK.JNL_TOKTJ_TEN DELETE処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% --show-warnings -vv -e "DELETE FROM INATK.JNL_TOKTJ_TEN T1 WHERE EXISTS (SELECT 1 FROM (SELECT DATE_FORMAT(SHORIDT, '%%Y%%m%%d') - INTERVAL X.MWDSU DAY AS SHORIDT FROM INAAD.SYSSHORIDT, (SELECT MWDSU FROM INAAD.SYSTOKDELCTL WHERE P_TABLENM = 'TOKTJ_JNL' AND PTNCD = '1') X) T2 WHERE T1.UPDDT <= T2.SHORIDT);commit;" >>%OUTFILE% 2>&1
IF NOT %ERRORLEVEL%==0 GOTO ERROR


SET MSG=%DATE% %TIME% 事前発注_追加商品_JNL INATK.JNL_TOKTJ_ADDSHN BACKUP処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
SET OUTFILENAME=%~DP0..\DATA\INATK.JNL_TOKTJ_ADDSHN
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% -N -e "SELECT COALESCE(SEQ, '') || ',' || COALESCE(LSTNO, '') || ',' || COALESCE(BMNCD, '') || ',' || COALESCE(HYOSEQNO, '') || ',' || COALESCE(TENCD, '') || ',' || COALESCE(SHNCD, '') || ',' || COALESCE(BINKBN, '') || ',' || COALESCE(JTDT_01, '') || ',' || COALESCE(JTDT_02, '') || ',' || COALESCE(JTDT_03, '') || ',' || COALESCE(JTDT_04, '') || ',' || COALESCE(JTDT_05, '') || ',' || COALESCE(JTDT_06, '') || ',' || COALESCE(JTDT_07, '') || ',' || COALESCE(JTDT_08, '') || ',' || COALESCE(JTDT_09, '') || ',' || COALESCE(JTDT_10, '') || ',' || COALESCE(HTSU_01, '') || ',' || COALESCE(HTSU_02, '') || ',' || COALESCE(HTSU_03, '') || ',' || COALESCE(HTSU_04, '') || ',' || COALESCE(HTSU_05, '') || ',' || COALESCE(HTSU_06, '') || ',' || COALESCE(HTSU_07, '') || ',' || COALESCE(HTSU_08, '') || ',' || COALESCE(HTSU_09, '') || ',' || COALESCE(HTSU_10, '') || ',' || COALESCE(PAGENO, '') || ',' || COALESCE(SENDFLG, '') || ',' || COALESCE(OPERATOR, '') || ',' || COALESCE(ADDDT, '') || ',' || COALESCE(UPDDT, '') FROM INATK.JNL_TOKTJ_ADDSHN;" >%OUTFILENAME% 2>>%OUTFILE%
IF NOT %ERRORLEVEL%==0 GOTO ERROR

SET MSG=%DATE% %TIME% 事前発注_追加商品_JNL INATK.JNL_TOKTJ_ADDSHN DELETE処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% --show-warnings -vv -e "DELETE FROM INATK.JNL_TOKTJ_ADDSHN T1 WHERE EXISTS (SELECT 1 FROM (SELECT DATE_FORMAT(SHORIDT, '%%Y%%m%%d') - INTERVAL X.MWDSU DAY AS SHORIDT FROM INAAD.SYSSHORIDT, (SELECT MWDSU FROM INAAD.SYSTOKDELCTL WHERE P_TABLENM = 'TOKTJ_JNL' AND PTNCD = '1') X) T2 WHERE T1.UPDDT <= T2.SHORIDT);commit;" >>%OUTFILE% 2>&1
IF NOT %ERRORLEVEL%==0 GOTO ERROR


SET MSG=%DATE% %TIME% 事前発注_部門予算_JNL INATK.JNL_TOKTJ_BMNYSAN BACKUP処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
SET OUTFILENAME=%~DP0..\DATA\INATK.JNL_TOKTJ_BMNYSAN
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% -N -e "SELECT COALESCE(SEQ, '') || ',' || COALESCE(LSTNO, '') || ',' || COALESCE(TENCD, '') || ',' || COALESCE(BMNCD, '') || ',' || COALESCE(TJDT, '') || ',' || COALESCE(BMNYSANAM, '') || ',' || COALESCE(OPERATOR, '') || ',' || COALESCE(ADDDT, '') || ',' || COALESCE(UPDDT, '') FROM INATK.JNL_TOKTJ_BMNYSAN;" >%OUTFILENAME% 2>>%OUTFILE%
IF NOT %ERRORLEVEL%==0 GOTO ERROR

SET MSG=%DATE% %TIME% 事前発注_部門予算_JNL INATK.JNL_TOKTJ_BMNYSAN DELETE処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% --show-warnings -vv -e "DELETE FROM INATK.JNL_TOKTJ_BMNYSAN T1 WHERE EXISTS (SELECT 1 FROM (SELECT DATE_FORMAT(SHORIDT, '%%Y%%m%%d') - INTERVAL X.MWDSU DAY AS SHORIDT FROM INAAD.SYSSHORIDT, (SELECT MWDSU FROM INAAD.SYSTOKDELCTL WHERE P_TABLENM = 'TOKTJ_JNL' AND PTNCD = '1') X) T2 WHERE T1.UPDDT <= T2.SHORIDT);commit;" >>%OUTFILE% 2>&1
IF NOT %ERRORLEVEL%==0 GOTO ERROR


SET MSG=%DATE% %TIME% 事前発注_構成比_JNL INATK.JNL_TOKTJ_BMNCMPRT BACKUP処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
SET OUTFILENAME=%~DP0..\DATA\INATK.JNL_TOKTJ_BMNCMPRT
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% -N -e "SELECT COALESCE(SEQ, '') || ',' || COALESCE(LSTNO, '') || ',' || COALESCE(TENCD, '') || ',' || COALESCE(BMNCD, '') || ',' || COALESCE(SURICMPRT, '') || ',' || COALESCE(SGRSCMPRT, '') || ',' || COALESCE(GRSYSANAM, '') || ',' || COALESCE(OPERATOR, '') || ',' || COALESCE(ADDDT, '') || ',' || COALESCE(UPDDT, '') FROM INATK.JNL_TOKTJ_BMNCMPRT;" >%OUTFILENAME% 2>>%OUTFILE%
IF NOT %ERRORLEVEL%==0 GOTO ERROR

SET MSG=%DATE% %TIME% 事前発注_構成比_JNL INATK.JNL_TOKTJ_BMNCMPRT DELETE処理
ECHO %MSG%
>> %OUTFILE% ECHO %MSG%
"%MYSQLPATH%mysql" %OPTION% -h %HOST% %DB_NAME% -u %USER_ID% --show-warnings -vv -e "DELETE FROM INATK.JNL_TOKTJ_BMNCMPRT T1 WHERE EXISTS (SELECT 1 FROM (SELECT DATE_FORMAT(SHORIDT, '%%Y%%m%%d') - INTERVAL X.MWDSU DAY AS SHORIDT FROM INAAD.SYSSHORIDT, (SELECT MWDSU FROM INAAD.SYSTOKDELCTL WHERE P_TABLENM = 'TOKTJ_JNL' AND PTNCD = '1') X) T2 WHERE T1.UPDDT <= T2.SHORIDT);commit;" >>%OUTFILE% 2>&1
IF NOT %ERRORLEVEL%==0 GOTO ERROR




:FINAL
EXIT /B 0

:ERROR
EXIT /B 1
